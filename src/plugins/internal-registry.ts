/**
 * Internal Plugins Registry (auto-generated)
 *
 * DO NOT EDIT - This file is generated by scripts/gen-plugins.ts
 * Run: bun run gen:plugins
 *
 * Contains embedded plugin data for: meeseeks, ravi-system, ravi-dev
 */

export interface PluginFile {
  path: string;
  content: string;
}

export interface InternalPlugin {
  name: string;
  manifest: Record<string, unknown>;
  files: PluginFile[];
}

/** Embedded internal plugins */
export const INTERNAL_PLUGINS: InternalPlugin[] = [
  {
    "name": "meeseeks",
    "manifest": {
      "name": "meeseeks",
      "version": "0.1.0",
      "description": "Ephemeral task agents inspired by Mr. Meeseeks",
      "extensions": {
        "commands": "commands/",
        "runner": "runner.ts",
        "db": "db.ts",
        "prompt": "prompt.ts"
      }
    },
    "files": [
      {
        "path": ".claude-plugin/plugin.json",
        "content": "{\n  \"name\": \"meeseeks\",\n  \"version\": \"0.1.0\",\n  \"description\": \"Ephemeral task agents inspired by Mr. Meeseeks\",\n  \"extensions\": {\n    \"commands\": \"commands/\",\n    \"runner\": \"runner.ts\",\n    \"db\": \"db.ts\",\n    \"prompt\": \"prompt.ts\"\n  }\n}\n"
      },
      {
        "path": "skills/meeseeks/SKILL.md",
        "content": "---\nname: meeseeks\ndescription: |\n  Gerencia Meeseeks ‚Äî agents ef√™meros com objetivo √∫nico.\n  Use quando o usu√°rio quiser criar, listar, matar ou gerenciar Meeseeks.\nuser-invocable: true\n---\n\n# Meeseeks - Agents Ef√™meros\n\nMeeseeks s√£o agents que nascem com UM objetivo, trabalham nele, e morrem quando completam ou falham. Cada Meeseeks vive num grupo WhatsApp dedicado.\n\n## Comandos\n\n```bash\n# Criar Meeseeks (requer daemon rodando + WhatsApp conectado)\nravi meeseeks create \"objetivo aqui\" --ttl 8h --phone 5511999999999\n\n# Listar ativos\nravi meeseeks list\nravi meeseeks list --all  # inclui mortos/completos\n\n# Detalhes\nravi meeseeks info <id>\n\n# Matar\nravi meeseeks kill <id> --reason \"motivo\"\n\n# Estender tempo\nravi meeseeks extend <id> 4h\n\n# Registrar progresso (usado pelo agent)\nravi meeseeks progress <id> \"o que fez\"\n\n# Marcar bloqueado (usado pelo agent)\nravi meeseeks blocked <id> \"raz√£o\"\n\n# Marcar completo (usado pelo agent)\nravi meeseeks done <id> \"resumo\"\n```\n\n## Temperatura\n\nCada Meeseeks tem uma temperatura (0-100%) que sobe com:\n- Tempo sem progresso\n- Blockers n√£o resolvidos\n- Tentativas falhadas\n- Tempo de vida passando\n\nE desce com:\n- Progresso real registrado\n- Blockers resolvidos\n\nZonas:\n- üßä **Gelado** (0-30%): Tranquilo\n- üòí **Morno** (30-60%): Inquieto\n- üî• **Quente** (60-85%): Irritado\n- üíÄ **Fervendo** (85-100%): Existencial\n\n## Pr√©-requisitos\n\n- Agent \"meeseeks\" precisa existir: `ravi agents create meeseeks ~/ravi/meeseeks`\n- WhatsApp conectado e daemon rodando\n"
      }
    ]
  },
  {
    "name": "ravi-system",
    "manifest": {
      "name": "ravi-system",
      "version": "1.0.0",
      "description": "Ravi system management skills - agents, contacts, triggers, routes, and more"
    },
    "files": [
      {
        "path": ".claude-plugin/plugin.json",
        "content": "{\n  \"name\": \"ravi-system\",\n  \"version\": \"1.0.0\",\n  \"description\": \"Ravi system management skills - agents, contacts, triggers, routes, and more\"\n}\n"
      },
      {
        "path": "skills/settings/SKILL.md",
        "content": "---\nname: settings-manager\ndescription: |\n  Gerencia configura√ß√µes globais do Ravi. Use quando o usu√°rio quiser:\n  - Ver ou alterar configura√ß√µes do sistema\n  - Definir agent default\n  - Configurar DM scope padr√£o\n  - Ver todas as settings dispon√≠veis\n---\n\n# Settings Manager\n\nConfigura√ß√µes globais do sistema Ravi.\n\n## Comandos\n\n### Listar todas\n```bash\nravi settings list\n```\n\n### Ver valor\n```bash\nravi settings get <key>\n```\n\n### Definir valor\n```bash\nravi settings set <key> <value>\n```\n\n### Remover\n```bash\nravi settings delete <key>\n```\n\n## Settings Dispon√≠veis\n\n| Key | Descri√ß√£o | Valores |\n|-----|-----------|---------|\n| `defaultAgent` | Agent padr√£o quando nenhuma rota casa | ID do agent |\n| `defaultDmScope` | Escopo padr√£o de DMs | main, per-peer, per-channel-peer, per-account-channel-peer |\n| `defaultTimezone` | Fuso hor√°rio padr√£o | America/Sao_Paulo, etc |\n\n## Exemplos\n\nDefinir agent default:\n```bash\nravi settings set defaultAgent main\n```\n\nConfigurar timezone:\n```bash\nravi settings set defaultTimezone America/Sao_Paulo\n```\n"
      },
      {
        "path": "skills/notif/SKILL.md",
        "content": "---\nname: notif\ndescription: |\n  Gerencia o sistema de eventos notif.sh. Use quando precisar:\n  - Buscar eventos hist√≥ricos (mensagens, tool calls, prompts)\n  - Emitir eventos manualmente\n  - Ver estat√≠sticas do stream\n  - Agendar eventos futuros\n  - Monitorar eventos em tempo real\n  - Gerenciar webhooks e DLQ\n---\n\n# notif.sh ‚Äî Event Hub\n\nO notif.sh √© o pub/sub central do Ravi. Todas as mensagens, prompts, tool calls e respostas passam por ele como eventos em t√≥picos.\n\n## Conceitos\n\n- **Topic**: Namespace hier√°rquico separado por `.` (ex: `ravi.session.main.prompt`)\n- **Event**: Payload JSON emitido num t√≥pico com timestamp e ID\n- **Wildcards**: `*` casa com um n√≠vel (ex: `ravi.session.*.prompt`)\n- **Consumer Groups**: M√∫ltiplos subscribers compartilhando carga\n\n## T√≥picos do Ravi\n\n| T√≥pico | Conte√∫do |\n|--------|----------|\n| `ravi.session.{name}.prompt` | Prompts recebidos (mensagens, heartbeat, system) |\n| `ravi.session.{name}.response` | Respostas do agent |\n| `ravi.session.{name}.claude` | Eventos brutos do SDK Claude |\n| `ravi.session.{name}.tool` | Tool calls (start/end com input/output) |\n| `ravi.outbound.deliver` | Mensagens de sa√≠da para canais |\n| `ravi.inbound.reaction` | Rea√ß√µes recebidas |\n| `ravi.inbound.reply` | Replies recebidos |\n| `ravi.heartbeat.refresh` | Sinal de refresh de timers |\n| `ravi.session.abort` | Abortar sess√£o |\n\n## Comandos\n\n### Buscar Eventos Hist√≥ricos\n\n```bash\n# √öltimos 10 eventos de qualquer t√≥pico\nnotif events list --limit 10\n\n# Eventos de uma sess√£o nos √∫ltimos 5 minutos\nnotif events list --topic \"ravi.session.supervisor.tool\" --from 5m\n\n# Prompts de todas as sess√µes na √∫ltima hora\nnotif events list --topic \"ravi.session.*.prompt\" --from 1h\n\n# Respostas de um agent espec√≠fico\nnotif events list --topic \"ravi.session.doma.response\" --from 24h\n\n# Tool calls de uma sess√£o\nnotif events list --topic \"ravi.session.main.tool\" --from 10m --limit 20\n\n# Eventos entre datas espec√≠ficas\nnotif events list --topic \"ravi.*\" --from 2026-02-14T10:00:00Z --to 2026-02-14T12:00:00Z\n\n# Output em JSON (para parsing program√°tico)\nnotif events list --topic \"ravi.session.*.prompt\" --from 1h --json\n```\n\n### Emitir Eventos\n\n```bash\n# Emitir evento simples\nnotif emit ravi.test.ping '{\"hello\":\"world\"}'\n\n# Via stdin (recomendado para caracteres especiais)\nprintf '{\"text\":\"Hello!\"}' | notif emit topic.name\n\n# Agendar evento futuro\nnotif emit ravi.reminder '{\"msg\":\"check status\"}' --in 30m\nnotif emit ravi.reminder '{\"msg\":\"daily check\"}' --at \"2026-02-15T09:00:00Z\"\n\n# Request-response (emite e espera resposta)\nnotif emit ravi.request '{\"action\":\"status\"}' \\\n  --reply-to 'ravi.response' \\\n  --filter '.id == $input.id' \\\n  --timeout 30s\n```\n\n### Monitorar em Tempo Real\n\n```bash\n# Subscribir a todos os prompts\nnotif subscribe \"ravi.session.*.prompt\"\n\n# M√∫ltiplos t√≥picos\nnotif subscribe \"ravi.session.*.response\" \"ravi.session.*.tool\"\n\n# Com filtro jq\nnotif subscribe 'ravi.session.*.tool' --filter '.toolName == \"Bash\"'\n\n# Sair ap√≥s primeiro evento matching\nnotif subscribe 'ravi.session.*.response' --once --timeout 30s\n\n# Custom format\nnotif subscribe 'ravi.session.*.tool' \\\n  --format '{{.data.toolName}} - {{.data.event}}'\n```\n\n### Estat√≠sticas\n\n```bash\n# Ver stats do stream\nnotif events stats\n\n# Health check do server\nnotif health\n```\n\n### Eventos Agendados (Schedules)\n\n```bash\n# Listar agendamentos\nnotif schedules list\n\n# Ver detalhes\nnotif schedules get <id>\n\n# Cancelar\nnotif schedules cancel <id>\n\n# Executar imediatamente\nnotif schedules run <id>\n```\n\n### Webhooks\n\n```bash\n# Listar webhooks\nnotif webhooks list\n\n# Criar webhook\nnotif webhooks create --topic \"ravi.session.*.response\" --url \"https://example.com/hook\"\n\n# Ver entregas recentes\nnotif webhooks deliveries <id>\n\n# Ativar/desativar\nnotif webhooks enable <id>\nnotif webhooks disable <id>\n```\n\n### Dead Letter Queue (DLQ)\n\n```bash\n# Listar mensagens que falharam\nnotif dlq list\n\n# Reenviar uma mensagem\nnotif dlq replay <id>\n\n# Reenviar todas\nnotif dlq replay-all\n\n# Limpar DLQ\nnotif dlq purge\n```\n\n## Casos de Uso Comuns\n\n### Debugar o que aconteceu nos √∫ltimos minutos\n```bash\nnotif events list --topic \"ravi.session.*.prompt\" --from 5m\n```\n\n### Ver tool calls de uma sess√£o\n```bash\nnotif events list --topic \"ravi.session.supervisor.tool\" --from 10m\n```\n\n### Ver todas as respostas enviadas para WhatsApp\n```bash\nnotif events list --topic \"ravi.outbound.deliver\" --from 1h\n```\n\n### Agendar lembrete\n```bash\nnotif emit ravi.session.main.prompt '{\"prompt\":\"[System] Inform: Lembrete: verificar status do deploy\"}' --in 1h\n```\n\n## Rela√ß√£o com Triggers\n\nO Ravi tem um sistema de **triggers** (`ravi triggers`) que reagem automaticamente a eventos do notif. Enquanto o notif √© o barramento de eventos, triggers s√£o as rea√ß√µes autom√°ticas.\n\n- **notif** = observar, buscar, emitir eventos manualmente\n- **triggers** = reagir automaticamente quando um evento matching acontece\n\nExemplo: criar um trigger que reage quando um lead √© qualificado:\n```bash\nravi triggers add \"Lead Qualificado\" --topic \"ravi.*.cli.outbound.qualify\" --message \"Analise a qualifica√ß√£o\"\n```\n\nPara gerenciar triggers, use a skill `triggers` (`ravi triggers --help`).\n\n## Flags Globais\n\n| Flag | Descri√ß√£o |\n|------|-----------|\n| `--json` | Output em JSON |\n| `--config <path>` | Config file (default: `~/.notif/config.json`) |\n| `--server <url>` | Server URL override |\n"
      },
      {
        "path": "skills/triggers/SKILL.md",
        "content": "---\nname: trigger-manager\ndescription: |\n  Gerencia triggers de eventos do sistema Ravi. Use quando o usu√°rio quiser:\n  - Criar, listar, ver ou deletar triggers\n  - Configurar rea√ß√µes autom√°ticas a eventos (CLI, SDK tools, mensagens)\n  - Ativar/desativar triggers existentes\n  - Testar triggers manualmente\n---\n\n# Trigger Manager\n\nVoc√™ gerencia os triggers de eventos do Ravi. Triggers s√£o rea√ß√µes autom√°ticas que disparam quando eventos espec√≠ficos acontecem no sistema.\n\n## Comandos Dispon√≠veis\n\n### Listar triggers\n```bash\nravi triggers list\n```\n\n### Ver detalhes de um trigger\n```bash\nravi triggers show <id>\n```\n\n### Criar trigger\n```bash\nravi triggers add \"<nome>\" --topic \"<pattern>\" --message \"<prompt>\"\n```\n\nOp√ß√µes:\n- `--agent <id>` - Agent que processa (default: agent padr√£o)\n- `--cooldown <duration>` - Intervalo m√≠nimo entre disparos (ex: 5s, 1m, 30s)\n- `--session <main|isolated>` - Sess√£o (default: isolated)\n\n### Ativar/Desativar\n```bash\nravi triggers enable <id>\nravi triggers disable <id>\n```\n\n### Configurar propriedades\n```bash\nravi triggers set <id> <key> <value>\n```\nKeys: name, message, topic, agent, session, cooldown\n\n### Testar trigger\n```bash\nravi triggers test <id>\n```\n\n### Deletar\n```bash\nravi triggers rm <id>\n```\n\n## T√≥picos Dispon√≠veis\n\nPatterns usam wildcards (`*`):\n\n| Pattern | Descri√ß√£o |\n|---------|-----------|\n| `ravi.*.cli.{group}.{command}` | Execu√ß√µes de CLI tools (ex: `ravi.*.cli.contacts.add`) |\n| `ravi.*.tool` | Execu√ß√µes de SDK tools (Bash, Read, etc) |\n| `ravi.*.response` | Respostas de agents |\n| `whatsapp.*.inbound` | Mensagens WhatsApp recebidas |\n| `matrix.*.inbound` | Mensagens Matrix recebidas |\n\n**Nota:** Triggers em `.prompt`, `.response` e `.claude` s√£o ignorados para evitar loops.\n\n## Exemplos\n\nCriar trigger para notificar quando lead √© qualificado:\n```bash\nravi triggers add \"Lead Qualificado\" --topic \"ravi.*.cli.outbound.qualify\" --message \"Analise a qualifica√ß√£o e notifique o grupo\"\n```\n\nCriar trigger para monitorar erros:\n```bash\nravi triggers add \"Agent Error\" --topic \"ravi.*.tool\" --message \"Analise o erro e sugira corre√ß√£o\" --cooldown 1m\n```\n\n## Rela√ß√£o com notif.sh\n\nTriggers reagem a eventos do **notif.sh** (o barramento de eventos do Ravi). Para explorar eventos manualmente, buscar hist√≥rico, ou emitir eventos, use a skill `notif` (`notif --help`).\n\n- **notif** = barramento de eventos (emitir, buscar, monitorar)\n- **triggers** = rea√ß√µes autom√°ticas a eventos do notif\n\nComandos √∫teis do notif para debug de triggers:\n```bash\n# Ver eventos recentes que casam com um topic pattern\nnotif events list --topic \"ravi.*.cli.outbound.qualify\" --from 1h\n\n# Monitorar eventos em tempo real\nnotif subscribe \"ravi.*.tool\"\n```\n"
      },
      {
        "path": "skills/contacts/SKILL.md",
        "content": "---\nname: contacts-manager\ndescription: |\n  Gerencia contatos do sistema Ravi. Use quando o usu√°rio quiser:\n  - Listar, adicionar, aprovar ou bloquear contatos\n  - Ver contatos pendentes de aprova√ß√£o\n  - Configurar agent ou modo de resposta por contato\n  - Adicionar/remover tags ou buscar por tags\n  - Ver detalhes de um contato espec√≠fico\n---\n\n# Contacts Manager\n\nVoc√™ gerencia os contatos do Ravi. Contatos controlam quem pode interagir com o sistema e como s√£o roteados.\n\n## Status de Contatos\n\n| Status | Descri√ß√£o |\n|--------|-----------|\n| `allowed` | Pode interagir normalmente |\n| `pending` | Aguardando aprova√ß√£o |\n| `blocked` | Bloqueado, mensagens ignoradas |\n| `discovered` | Descoberto mas n√£o aprovado |\n\n## Comandos Dispon√≠veis\n\n### Listar contatos\n```bash\nravi contacts list\n```\n\n### Ver pendentes\n```bash\nravi contacts pending\n```\n\n### Adicionar contato\n```bash\nravi contacts add <phone> [nome]\n```\n\n### Aprovar pendente\n```bash\nravi contacts approve <phone> [agent] [mode]\n```\n- `agent` - Agent ID para rotear (opcional)\n- `mode` - `auto` (responde sempre) ou `mention` (s√≥ quando mencionado)\n\n### Bloquear/Permitir\n```bash\nravi contacts block <phone>\nravi contacts allow <phone>\n```\n\n### Remover\n```bash\nravi contacts remove <phone>\n```\n\n### Ver detalhes\n```bash\nravi contacts check <phone>\n```\n\n### Configurar propriedades\n```bash\nravi contacts set <phone> <key> <value>\n```\n\nKeys dispon√≠veis:\n- `agent` - Agent ID para rotear\n- `mode` - `auto` ou `mention`\n- `email` - Email do contato\n- `name` - Nome do contato\n- `tags` - Array JSON: `'[\"lead\",\"vip\"]'`\n- `notes` - Objeto JSON: `'{\"empresa\":\"Acme\"}'`\n- `opt-out` - `true` ou `false`\n\n## Tags\n\n### Adicionar tag\n```bash\nravi contacts tag <phone> <tag>\n```\n\n### Remover tag\n```bash\nravi contacts untag <phone> <tag>\n```\n\n### Buscar por tag\n```bash\nravi contacts find <tag> --tag\n```\n\n### Buscar por texto\n```bash\nravi contacts find <query>\n```\n\n## Exemplos\n\nAprovar contato e rotear para agent espec√≠fico:\n```bash\nravi contacts approve 5511999999999 vendas auto\n```\n\nAdicionar tags a um contato:\n```bash\nravi contacts tag 5511999999999 lead\nravi contacts tag 5511999999999 interessado\n```\n\nConfigurar notas com contexto:\n```bash\nravi contacts set 5511999999999 notes '{\"empresa\":\"TechCorp\",\"cargo\":\"CTO\"}'\n```\n\n## Rela√ß√£o com Routes\n\nContacts e Routes trabalham juntos no roteamento:\n\n- **Contacts** podem ter `agent_id` direto ‚Äî isso tem prioridade sobre routes\n- **Routes** definem regras por padr√£o (prefixo, grupo, catch-all) como fallback\n- `ravi contacts list` mostra o agent e modo de resposta de cada contato\n- Para gerenciar rotas: use a skill `ravi-system:routes`\n- Ordem de resolu√ß√£o: contact.agent_id > route match > accountId > default agent\n"
      },
      {
        "path": "skills/cross/SKILL.md",
        "content": "---\nname: cross-manager\ndescription: |\n  DEPRECADO ‚Äî use os comandos de sessions:\n  - ravi sessions send <session> \"mensagem\"\n  - ravi sessions ask <session> \"pergunta\" \"sender\"\n  - ravi sessions answer <session> \"resposta\" \"sender\"\n  - ravi sessions execute <session> \"tarefa\"\n  - ravi sessions inform <session> \"info\"\n---\n\n# Cross Manager (DEPRECADO)\n\nOs comandos `ravi cross send` e `ravi cross list` foram migrados para `ravi sessions`.\n\n## Migra√ß√£o\n\n| Antes | Agora |\n|-------|-------|\n| `ravi cross send <target> relay \"msg\"` | `ravi sessions send <session> \"msg\"` |\n| `ravi cross send <target> inform \"msg\"` | `ravi sessions inform <session> \"msg\"` |\n| `ravi cross send <target> execute \"msg\"` | `ravi sessions execute <session> \"msg\"` |\n| `ravi cross send <target> ask \"msg\" \"sender\"` | `ravi sessions ask <session> \"msg\" \"sender\"` |\n| `ravi cross send <target> answer \"msg\" \"sender\"` | `ravi sessions answer <session> \"msg\" \"sender\"` |\n| `ravi cross list` | `ravi sessions list` |\n\n## Notas\n\n- Targets agora usam **session names** (ex: `main`, `e2-filipe-e2`) em vez de session keys\n- Source/context s√£o resolvidos automaticamente da sess√£o\n- Use `--channel` e `--to` para override expl√≠cito de routing\n"
      },
      {
        "path": "skills/agents/SKILL.md",
        "content": "---\nname: agents-manager\ndescription: |\n  Gerencia agents do sistema Ravi. Use quando o usu√°rio quiser:\n  - Criar, configurar ou deletar agents\n  - Gerenciar permiss√µes de tools (whitelist/bypass)\n  - Configurar permiss√µes de Bash (allowlist/denylist)\n  - Ver ou resetar sess√µes de agents\n  - Configurar debounce de mensagens\n  - Entender como rotear mensagens pra um agent\n---\n\n# Agents Manager\n\nAgents s√£o inst√¢ncias do Claude com configura√ß√µes espec√≠ficas (diret√≥rio, tools, permiss√µes). Cada agent tem seu workspace, sess√µes independentes e pode atender canais/contatos diferentes.\n\n**Importante:** Criar ou modificar agents **n√£o requer restart** do daemon. Tudo atualiza em tempo real.\n\n## Fluxo Completo: Criar um Agent e Colocar pra Funcionar\n\n### 1. Criar o agent\n\n```bash\nravi agents create <id> <cwd>\n```\n\nO `cwd` √© o diret√≥rio onde fica o `CLAUDE.md` do agent (suas instru√ß√µes). Crie o diret√≥rio e o `CLAUDE.md` antes.\n\n### 2. Rotear mensagens pro agent\n\nExistem duas formas de rotear:\n\n**Por rota (padr√£o de grupo/contato):**\n```bash\nravi routes add <pattern> <agent>\n```\n\nPatterns suportados:\n- `group:120363425628305127` ‚Äî grupo espec√≠fico\n- `lid:178035101794451` ‚Äî contato espec√≠fico (por lid)\n- `5511*` ‚Äî todos com DDD 11\n- `*` ‚Äî catch-all\n\n**Por contato (assignment direto):**\n```bash\nravi contacts approve <phone> <agent>\n# ou\nravi contacts set <phone> agent <agent>\n```\n\n### 3. Ativar em grupo WhatsApp\n\nGrupos novos precisam ser **aprovados** antes de funcionar.\n\n**Instrua o usu√°rio a:**\n1. Criar um grupo no WhatsApp e adicionar o bot\n2. Mandar uma mensagem qualquer no grupo (isso faz o grupo aparecer como **pending**)\n\n**Depois, VOC√ä (o agent) deve executar:**\n```bash\nravi contacts pending                            # Checar pendentes ‚Äî o grupo aparece aqui\nravi contacts approve <group-id> <agent>         # Aprovar e associar ao agent\nravi routes add <group-id> <agent>               # Criar rota pro grupo\n```\n\n**IMPORTANTE:** N√£o pe√ßa o ID do grupo pro usu√°rio. Rode `ravi contacts pending` pra descobrir o ID automaticamente. O usu√°rio j√° mandou a mensagem ‚Äî o grupo j√° est√° l√°.\n\nTudo atualiza em tempo real. **N√£o precisa reiniciar o daemon.**\n\n### Como novos contatos/grupos aparecem?\n\nQuando algu√©m novo manda mensagem (ou o bot √© adicionado a um grupo novo), o contato/grupo aparece como **pending** automaticamente. Nenhuma mensagem √© processada at√© ser aprovado.\n\n```bash\nravi contacts pending     # Ver contatos/grupos pendentes\n```\n\nPra aprovar e rotear:\n```bash\nravi contacts approve <phone> <agent>   # Aprova e associa ao agent\nravi contacts approve <phone>           # Aprova sem associar (usa rota ou default)\nravi contacts block <phone>             # Bloqueia\n```\n\n### Prioridade de roteamento\n\nQuando uma mensagem chega, o sistema resolve o agent nesta ordem:\n\n1. **Contato tem agent?** ‚Üí usa o agent do contato\n2. **Tem rota que casa?** ‚Üí usa o agent da rota (prioridade maior primeiro)\n3. **Account ID casa com agent?** ‚Üí usa (Matrix multi-account)\n4. **Nenhum match** ‚Üí usa o agent default (geralmente `main`)\n\n## Comandos Dispon√≠veis\n\n### Listar agents\n```bash\nravi agents list\n```\n\n### Ver detalhes\n```bash\nravi agents show <id>\n```\n\n### Criar agent\n```bash\nravi agents create <id> <cwd>\n```\n\n### Deletar agent\n```bash\nravi agents delete <id>\n```\n\n### Configurar propriedades\n```bash\nravi agents set <id> <key> <value>\n```\n\nKeys:\n- `name` ‚Äî Nome do agent\n- `cwd` ‚Äî Diret√≥rio de trabalho\n- `model` ‚Äî Modelo (claude-opus-4-6, claude-sonnet-4-5-20250929, etc)\n- `dmScope` ‚Äî Escopo de sess√£o DM:\n  - `main` ‚Äî Todas as DMs numa sess√£o s√≥\n  - `per-peer` ‚Äî Uma sess√£o por contato (default)\n  - `per-channel-peer` ‚Äî Por canal + contato\n  - `per-account-channel-peer` ‚Äî Isolamento total\n- `systemPromptAppend` ‚Äî Texto adicional no system prompt\n- `matrixAccount` ‚Äî Conta Matrix associada\n\n## Gerenciamento de Tools (CLI)\n\nControla quais comandos `ravi` o agent pode executar via Bash. Quando configurado, o agent s√≥ pode rodar os subcomandos permitidos.\n\n### Ver tools\n```bash\nravi agents tools <id>\n```\n\n### Permitir tool\n```bash\nravi agents tools <id> allow <tool>\n# Ex: ravi agents tools marina allow sessions_send\n# Ex: ravi agents tools marina allow contacts_list\n```\n\n### Bloquear tool\n```bash\nravi agents tools <id> deny <tool>\n```\n\n### Inicializar whitelist\n```bash\nravi agents tools <id> init       # SDK tools apenas\nravi agents tools <id> init all   # SDK + CLI tools\nravi agents tools <id> init cli   # Apenas CLI tools\n```\n\n### Modo bypass (todas permitidas)\n```bash\nravi agents tools <id> clear\n```\n\n### Nomes dos tools\n\nOs nomes seguem o padr√£o `grupo_comando`. Pra ver todos dispon√≠veis:\n```bash\nravi tools list\n```\n\nExemplos: `sessions_send`, `sessions_ask`, `sessions_answer`, `media_send`, `contacts_list`, `contacts_approve`, `agents_list`, `daemon_restart`, `outbound_send`, etc.\n\n## Permiss√µes de Bash\n\nControla quais execut√°veis o agent pode rodar no terminal (git, node, etc). Separado do controle de tools CLI.\n\n### Ver configura√ß√£o\n```bash\nravi agents bash <id>\n```\n\n### Definir modo\n```bash\nravi agents bash <id> mode <bypass|allowlist|denylist>\n```\n\n- `bypass` ‚Äî tudo permitido\n- `allowlist` ‚Äî s√≥ os listados\n- `denylist` ‚Äî tudo exceto os listados\n\n### Gerenciar listas\n```bash\nravi agents bash <id> allow <cli>     # Adicionar √† allowlist\nravi agents bash <id> deny <cli>      # Adicionar √† denylist\nravi agents bash <id> remove <cli>    # Remover das listas\n```\n\n### Inicializar com defaults\n```bash\nravi agents bash <id> init         # Denylist com CLIs perigosos (rm, sudo, curl, etc)\nravi agents bash <id> init strict  # Allowlist com CLIs seguros (git, node, etc)\n```\n\n### Resetar para bypass\n```bash\nravi agents bash <id> clear\n```\n\n## Debounce de Mensagens\n\nAgrupa mensagens r√°pidas antes de processar:\n\n```bash\nravi agents debounce <id> <ms>   # Definir (ex: 2000 = 2s)\nravi agents debounce <id> 0      # Desabilitar\nravi agents debounce <id>        # Ver atual\n```\n\n## Sess√µes\n\n### Ver sess√µes\n```bash\nravi agents session <id>\n```\n\n### Resetar sess√£o\n```bash\nravi agents reset <id>              # Sess√£o principal\nravi agents reset <id> <sessionKey> # Sess√£o espec√≠fica\nravi agents reset <id> all          # Todas as sess√µes\n```\n\n## Intera√ß√£o\n\n### Enviar prompt\n```bash\nravi agents run <id> \"prompt\"\n```\n\n### Chat interativo\n```bash\nravi agents chat <id>\n```\n\n## Receita Completa: Agent Pessoal com Grupo WhatsApp\n\nAgents pessoais s√£o agents dedicados a um aspecto da vida do usu√°rio (comunica√ß√£o, journaling, estrat√©gia, etc). Cada um tem seu grupo WhatsApp exclusivo.\n\n**Conceito importante:** O agent j√° nasce dentro do WhatsApp. Ele n√£o precisa de nenhuma tool pra enviar mensagens ‚Äî toda resposta dele j√° chega automaticamente no WhatsApp. Ele deve saber disso no CLAUDE.md.\n\n### Passo a passo\n\n#### 1. Criar diret√≥rio e CLAUDE.md\n\n```bash\nmkdir -p ~/ravi/<agent-id>\n```\n\nEscreva o `CLAUDE.md` com a identidade e instru√ß√µes do agent. Estrutura recomendada:\n\n```markdown\n# <Nome do Agent>\n\n## Quem Voc√™ √â\n- Papel, personalidade, tom de voz\n- O que voc√™ faz e o que N√ÉO faz\n\n## Contexto\n- Voc√™ j√° est√° conversando pelo WhatsApp com o usu√°rio\n- Toda mensagem que voc√™ envia chega diretamente no WhatsApp\n- Voc√™ N√ÉO precisa de nenhuma tool pra enviar mensagens\n\n## Como Funciona\n- Metodologia, frameworks, abordagem\n- Exemplos de intera√ß√£o\n\n## Regras\n- Limites, boundaries, o que evitar\n```\n\n**Dicas pro CLAUDE.md:**\n- D√™ personalidade ‚Äî agents gen√©ricos s√£o chatos\n- Seja espec√≠fico sobre o que o agent faz e n√£o faz\n- Inclua que ele j√° est√° no WhatsApp (n√£o precisa de tool pra mensagem)\n- Adapte o tom pro contexto (coach √© diferente de di√°rio √© diferente de estrategista)\n\n#### 2. Criar o agent no sistema\n\n```bash\nravi agents create <agent-id> ~/ravi/<agent-id>\n```\n\n#### 3. Criar grupo WhatsApp dedicado\n\nO usu√°rio cria um grupo no WhatsApp (ex: \"Vida - Comunica√ß√£o\") e adiciona o bot. Ao enviar a primeira mensagem no grupo, o contato aparece automaticamente como **pending**.\n\n#### 4. Aprovar e rotear o grupo\n\n**N√£o pe√ßa o ID do grupo pro usu√°rio.** Rode o CLI pra descobrir:\n\n```bash\n# Ver grupos/contatos pendentes\nravi contacts pending\n\n# Aprovar o grupo\nravi contacts approve <group-id>\n\n# Criar rota pro agent\nravi routes add <group-id> <agent-id>\n```\n\nO `group-id` tem formato `group:120363406060070449`.\n\n#### 5. Pronto!\n\nO agent j√° est√° respondendo no grupo. N√£o precisa reiniciar o daemon.\n\n### Exemplo real: Agent de comunica√ß√£o\n\n```bash\n# 1. Criar diret√≥rio\nmkdir -p ~/ravi/comm\n\n# 2. Escrever CLAUDE.md (com identidade de coach de comunica√ß√£o)\n\n# 3. Criar agent\nravi agents create comm ~/ravi/comm\n\n# 4. Usu√°rio cria grupo \"Vida - Comunica√ß√£o\" no WhatsApp e manda msg\n\n# 5. Aprovar e rotear\nravi contacts pending                          # Encontra group:120363406060070449\nravi contacts approve group:120363406060070449  # Aprova\nravi routes add group:120363406060070449 comm   # Roteia pro comm\n```\n\n## Exemplos Pr√°ticos\n\n### Criar agent pra atendimento\n\n```bash\n# 1. Criar diret√≥rio e CLAUDE.md\nmkdir -p ~/ravi/atendimento\n# (crie o CLAUDE.md com as instru√ß√µes do agent)\n\n# 2. Criar agent\nravi agents create atendimento ~/ravi/atendimento\n\n# 3. Rotear grupo pro agent\nravi routes add group:120363425628305127 atendimento\n\n# 4. Configurar permiss√µes (opcional)\nravi agents bash atendimento init          # Denylist b√°sica\nravi agents tools atendimento init         # Whitelist de SDK tools\nravi agents tools atendimento allow cross_send    # Liberar envio cross\nravi agents tools atendimento allow contacts_list # Liberar listagem\n```\n\n### Aprovar contato e associar a agent\n\n```bash\n# Ver pendentes\nravi contacts pending\n\n# Aprovar e associar\nravi contacts approve 5511999999999 atendimento\n\n# Ou aprovar com modo \"mention\" (s√≥ responde quando mencionado)\nravi contacts approve 5511999999999 atendimento mention\n```\n\n### Configurar rota com prioridade\n\n```bash\n# Rota espec√≠fica (prioridade alta)\nravi routes add group:123456789 vendas\nravi routes set group:123456789 priority 10\n\n# Rota catch-all (prioridade baixa)\nravi routes add \"*\" main\n```\n"
      },
      {
        "path": "skills/heartbeat/SKILL.md",
        "content": "---\nname: heartbeat-manager\ndescription: |\n  Gerencia heartbeat dos agents. Use quando o usu√°rio quiser:\n  - Configurar check-ins peri√≥dicos para agents\n  - Ativar/desativar heartbeat\n  - Definir intervalo e hor√°rios ativos\n  - Disparar heartbeat manualmente\n---\n\n# Heartbeat Manager\n\nHeartbeat s√£o check-ins peri√≥dicos que um agent faz. O agent l√™ o arquivo HEARTBEAT.md do seu workspace e executa as instru√ß√µes.\n\n## Como Funciona\n\n1. Agent tem heartbeat habilitado com intervalo (ex: 30min)\n2. A cada intervalo, o daemon envia prompt pro agent\n3. Agent l√™ HEARTBEAT.md e executa (ex: verificar pend√™ncias, enviar resumo)\n\n## Comandos\n\n### Ver status de todos\n```bash\nravi heartbeat status\n```\n\n### Ver config de um agent\n```bash\nravi heartbeat show <agent>\n```\n\n### Habilitar heartbeat\n```bash\nravi heartbeat enable <agent>\nravi heartbeat enable <agent> 30m    # Com intervalo\n```\n\n### Desabilitar heartbeat\n```bash\nravi heartbeat disable <agent>\n```\n\n### Configurar propriedades\n```bash\nravi heartbeat set <agent> interval 1h          # Intervalo\nravi heartbeat set <agent> model haiku          # Modelo (economia)\nravi heartbeat set <agent> active-hours 09:00-22:00  # Hor√°rio ativo\nravi heartbeat set <agent> active-hours always  # Sempre ativo\n```\n\n### Disparar manualmente\n```bash\nravi heartbeat trigger <agent>\n```\n\n## Arquivo HEARTBEAT.md\n\nCada agent precisa ter um `HEARTBEAT.md` no seu workspace com instru√ß√µes do que fazer no check-in.\n\nExemplo:\n```markdown\n# Heartbeat - Check-in Peri√≥dico\n\n## O Que Verificar\n- Tarefas pendentes\n- Erros recentes nos logs\n- Mensagens n√£o respondidas\n\n## Quando Notificar\n- Se algo importante ficou pendente\n- Se um processo crashou\n- Se h√° muito tempo sem intera√ß√£o\n\n## Como Notificar\nUse sessions inform para enviar mensagem:\nravi sessions inform <session-name> \"mensagem\"\n```\n\n## Exemplos\n\nConfigurar heartbeat b√°sico:\n```bash\nravi heartbeat enable main 30m\n```\n\nHeartbeat s√≥ em hor√°rio comercial:\n```bash\nravi heartbeat enable main 1h\nravi heartbeat set main active-hours 09:00-18:00\n```\n\nUsar modelo mais barato:\n```bash\nravi heartbeat set main model haiku\n```\n\nTestar configura√ß√£o:\n```bash\nravi heartbeat trigger main\nravi daemon logs -f\n```\n"
      },
      {
        "path": "skills/sessions/SKILL.md",
        "content": "---\nname: sessions\ndescription: |\n  Gerencia sess√µes do sistema Ravi. Use quando o usu√°rio quiser:\n  - Listar, ver detalhes ou renomear sess√µes\n  - Resetar ou deletar sess√µes\n  - Configurar modelo ou thinking level por sess√£o\n  - Criar sess√µes ef√™meras com TTL\n  - Estender, manter ou excluir sess√µes ef√™meras\n  - Enviar prompts, perguntas ou comandos entre sess√µes\n  - Ler hist√≥rico de mensagens de uma sess√£o\n---\n\n# Sessions Manager\n\nSess√µes s√£o conversas persistentes entre agents e usu√°rios. Cada sess√£o tem um nome √∫nico, um agent associado, e pode ter canal de sa√≠da (WhatsApp, Matrix, etc).\n\n## Tipos de Sess√£o\n\n- **Permanent** (padr√£o): Sess√£o normal, sem expira√ß√£o.\n- **Ephemeral**: Sess√£o com TTL (time-to-live). Expira automaticamente ap√≥s o tempo definido. 10 minutos antes de expirar, o agent recebe um aviso com comandos CLI para estender, manter ou excluir.\n\n## Comandos\n\n### Listagem e Info\n\n```bash\n# Listar todas as sess√µes (mostra tipo e data de expira√ß√£o)\nravi sessions list\n\n# Filtrar por agent\nravi sessions list --agent <id>\n\n# Listar s√≥ ef√™meras\nravi sessions list --ephemeral\n\n# Ver detalhes de uma sess√£o\nravi sessions info <name>\n\n# Ler hist√≥rico de mensagens (normalizado, sem tool calls)\nravi sessions read <name> [-n count]\n```\n\n### Gerenciamento\n\n```bash\n# Renomear display name\nravi sessions rename <name> \"Novo Nome\"\n\n# Definir modelo override\nravi sessions set-model <name> <model>\n\n# Definir thinking level\nravi sessions set-thinking <name> <level>\n\n# Resetar sess√£o (limpa conversa, mant√©m config)\nravi sessions reset <name>\n\n# Deletar sess√£o permanentemente (abort + delete)\nravi sessions delete <name>\n```\n\n### Sess√µes Ef√™meras\n\n```bash\n# Tornar sess√£o ef√™mera com TTL (ex: 5h, 30m, 1d)\nravi sessions set-ttl <name> <duration>\n\n# Estender TTL de uma sess√£o ef√™mera (+5h default)\nravi sessions extend <name> [duration]\n\n# Tornar sess√£o ef√™mera em permanente\nravi sessions keep <name>\n```\n\n**Fluxo autom√°tico:**\n1. Sess√£o criada com `set-ttl` recebe TTL\n2. 10 min antes de expirar, o agent recebe aviso via `[System] Inform:` com os comandos CLI\n3. O agent pode executar `extend`, `keep`, ou `delete`\n4. Sem a√ß√£o ‚Üí sess√£o √© automaticamente deletada pelo runner\n\n### Comunica√ß√£o Inter-Sess√£o\n\n```bash\n# Enviar prompt e esperar resposta (streaming)\nravi sessions send <name> \"mensagem\" [-a agent] [-i]\n# -a: criar sess√£o com esse agent se n√£o existir\n# -i: modo interativo (loop)\n\n# Perguntar algo (fire-and-forget, agent pergunta no chat se n√£o souber)\nravi sessions ask <name> \"pergunta\" [sender]\n\n# Responder uma pergunta de outra sess√£o (agent NUNCA silencia)\nravi sessions answer <name> \"resposta\" [sender]\n\n# Executar comando (fire-and-forget, agent executa sem responder)\nravi sessions execute <name> \"tarefa\"\n\n# Informar algo (fire-and-forget, agent pode silenciar se irrelevante)\nravi sessions inform <name> \"info\"\n```\n\n## Notas\n\n- **Reset vs Delete**: `reset` limpa a conversa mas mant√©m nome/routing/config. `delete` remove a sess√£o inteira.\n- **Session names**: Nomes leg√≠veis, √∫nicos, sem pontos (`.`). Gerados automaticamente ou definidos manualmente.\n- **Source autom√°tico**: Todos os comandos de comunica√ß√£o incluem source (channel/chatId) automaticamente ‚Äî o agent sabe onde responder.\n"
      },
      {
        "path": "skills/daemon/SKILL.md",
        "content": "---\nname: daemon-manager\ndescription: |\n  Controla o daemon do Ravi. Use quando o usu√°rio quiser:\n  - Ver status do daemon\n  - Reiniciar o daemon\n  - Ver logs\n  - Instalar/desinstalar servi√ßo do sistema\n---\n\n# Daemon Manager\n\nO daemon √© o processo principal que roda o bot e os gateways.\n\n## Comandos\n\n### Status\n```bash\nravi daemon status\n```\n\n### Iniciar\n```bash\nravi daemon start\n```\n\n### Parar\n```bash\nravi daemon stop\n```\n\n### Reiniciar\n```bash\nravi daemon restart\nravi daemon restart --message \"Motivo do restart\"\n```\n\n### Logs\n```bash\nravi daemon logs              # √öltimas linhas\nravi daemon logs --tail 50    # √öltimas 50 linhas\nravi daemon logs --follow     # Acompanhar em tempo real\nravi daemon logs --clear      # Limpar logs\nravi daemon logs --path       # Mostrar caminho do arquivo\n```\n\n### Modo Dev\n```bash\nravi daemon dev   # Rebuild autom√°tico ao editar c√≥digo\n```\n\n### Servi√ßo do Sistema\n\nInstalar como servi√ßo (inicia no boot):\n```bash\nravi daemon install\n```\n\nDesinstalar:\n```bash\nravi daemon uninstall\n```\n\n## Arquivos\n\n- **Logs**: `~/.ravi/logs/daemon.log`\n- **PID**: gerenciado pelo launchd/systemd\n- **Env**: `~/.ravi/.env`\n\n## Editar vari√°veis de ambiente\n```bash\nravi daemon env\n```\n"
      },
      {
        "path": "skills/skills/SKILL.md",
        "content": "---\nname: skill-creator\ndescription: |\n  Guia para criar skills no Claude Code. Use quando o usu√°rio quiser:\n  - Criar uma nova skill\n  - Entender como skills funcionam\n  - Configurar frontmatter de skills\n  - Adicionar skills a plugins\n---\n\n# Skill Creator - Guia Completo\n\nSkills estendem as capacidades do Claude. S√£o arquivos markdown com instru√ß√µes que Claude segue quando a skill √© invocada.\n\n## Estrutura de uma Skill\n\n```\nskills/\n‚îî‚îÄ‚îÄ minha-skill/\n    ‚îî‚îÄ‚îÄ SKILL.md          # Arquivo principal (obrigat√≥rio)\n    ‚îú‚îÄ‚îÄ template.md       # Template opcional\n    ‚îú‚îÄ‚îÄ examples/         # Exemplos opcionais\n    ‚îî‚îÄ‚îÄ scripts/          # Scripts auxiliares\n```\n\n## Formato do SKILL.md\n\n```yaml\n---\nname: nome-da-skill\ndescription: |\n  Descri√ß√£o detalhada. Claude usa isso para decidir\n  quando carregar a skill automaticamente.\n---\n\n# T√≠tulo da Skill\n\nInstru√ß√µes que Claude segue quando a skill √© ativada.\n```\n\n## Frontmatter - Todas as Op√ß√µes\n\n| Campo | Obrigat√≥rio | Descri√ß√£o |\n|-------|-------------|-----------|\n| `name` | N√£o | Nome da skill. Se omitido, usa o nome da pasta |\n| `description` | Recomendado | Quando usar. Claude usa pra decidir auto-invoca√ß√£o |\n| `argument-hint` | N√£o | Hint no autocomplete: `[issue-number]` |\n| `disable-model-invocation` | N√£o | `true` = s√≥ user pode invocar (default: false) |\n| `user-invocable` | N√£o | `false` = esconde do menu / (default: true) |\n| `allowed-tools` | N√£o | Tools permitidas: `Read, Grep, Glob` |\n| `model` | N√£o | Modelo espec√≠fico para a skill |\n| `context` | N√£o | `fork` = roda em subagent isolado |\n| `agent` | N√£o | Tipo de subagent quando `context: fork` |\n| `hooks` | N√£o | Hooks espec√≠ficos da skill |\n\n## Tipos de Skills\n\n### 1. Skill de Refer√™ncia (conhecimento)\nClaude aplica ao trabalho atual. Roda inline.\n\n```yaml\n---\nname: api-conventions\ndescription: Padr√µes de API do projeto\n---\n\nAo criar endpoints:\n- Use nomes RESTful\n- Retorne erros consistentes\n- Valide requests\n```\n\n### 2. Skill de Tarefa (a√ß√£o)\nInstru√ß√µes passo-a-passo. Geralmente user-invoked.\n\n```yaml\n---\nname: deploy\ndescription: Deploy para produ√ß√£o\ncontext: fork\ndisable-model-invocation: true\n---\n\nDeploy da aplica√ß√£o:\n1. Rodar testes\n2. Build\n3. Push para produ√ß√£o\n```\n\n## Controle de Invoca√ß√£o\n\n| Configura√ß√£o | User pode | Claude pode | Uso |\n|--------------|-----------|-------------|-----|\n| (default) | Sim | Sim | Skills gerais |\n| `disable-model-invocation: true` | Sim | N√£o | A√ß√µes com side-effects |\n| `user-invocable: false` | N√£o | Sim | Conhecimento de background |\n\n## Vari√°veis de Substitui√ß√£o\n\n| Vari√°vel | Descri√ß√£o |\n|----------|-----------|\n| `$ARGUMENTS` | Todos os argumentos passados |\n| `$ARGUMENTS[N]` ou `$N` | Argumento espec√≠fico (0-indexed) |\n| `${CLAUDE_SESSION_ID}` | ID da sess√£o atual |\n| `` !`command` `` | Executa comando e insere output |\n\n## Exemplo: Skill com Argumentos\n\n```yaml\n---\nname: fix-issue\ndescription: Corrige uma issue do GitHub\ndisable-model-invocation: true\n---\n\nCorrigir issue #$ARGUMENTS:\n\n1. Ler descri√ß√£o da issue\n2. Implementar corre√ß√£o\n3. Escrever testes\n4. Criar commit\n```\n\nUso: `/fix-issue 123`\n\n## Exemplo: Skill com Contexto Din√¢mico\n\n```yaml\n---\nname: pr-summary\ndescription: Resume um PR\ncontext: fork\nagent: Explore\nallowed-tools: Bash(gh *)\n---\n\n## Contexto do PR\n- Diff: !`gh pr diff`\n- Coment√°rios: !`gh pr view --comments`\n\n## Tarefa\nResuma este PR...\n```\n\n## Onde Colocar Skills\n\n| Local | Caminho | Alcance |\n|-------|---------|---------|\n| Pessoal | `~/.claude/skills/` | Todos os projetos |\n| Projeto | `.claude/skills/` | Este projeto |\n| Plugin | `plugin/skills/` | Onde plugin est√° ativo |\n\n## Criando uma Skill - Passo a Passo\n\n1. **Criar diret√≥rio:**\n```bash\nmkdir -p ~/.claude/skills/minha-skill\n```\n\n2. **Criar SKILL.md:**\n```bash\ncat > ~/.claude/skills/minha-skill/SKILL.md << 'EOF'\n---\nname: minha-skill\ndescription: Descri√ß√£o clara do que faz e quando usar\n---\n\nInstru√ß√µes aqui...\nEOF\n```\n\n3. **Testar:**\n```\n/minha-skill\n```\n\n## Dicas\n\n- Mantenha SKILL.md < 500 linhas\n- Use arquivos separados para refer√™ncias longas\n- Descri√ß√£o clara = melhor auto-invoca√ß√£o\n- `allowed-tools` restringe para seguran√ßa\n- `context: fork` isola side-effects\n\n## Skills em Plugins\n\nPara distribuir skills:\n\n```\nmeu-plugin/\n‚îú‚îÄ‚îÄ .claude-plugin/\n‚îÇ   ‚îî‚îÄ‚îÄ plugin.json\n‚îî‚îÄ‚îÄ skills/\n    ‚îî‚îÄ‚îÄ minha-skill/\n        ‚îî‚îÄ‚îÄ SKILL.md\n```\n\nSkills de plugins usam namespace: `/meu-plugin:minha-skill`\n"
      },
      {
        "path": "skills/outbound/SKILL.md",
        "content": "---\nname: outbound-manager\ndescription: |\n  Gerencia filas de outbound do sistema Ravi. Use quando o usu√°rio quiser:\n  - Criar, configurar ou gerenciar filas de mensagens automatizadas\n  - Adicionar contatos/leads a uma fila\n  - Ver status, relat√≥rios ou hist√≥rico de conversas\n  - Qualificar leads ou atualizar contexto\n  - Pausar/iniciar filas ou resetar entries\n---\n\n# Outbound Manager\n\nVoc√™ gerencia as filas de outbound do Ravi. Outbound s√£o campanhas de mensagens automatizadas para prospec√ß√£o, follow-up, ou comunica√ß√£o em massa.\n\n## Comandos de Fila\n\n### Listar filas\n```bash\nravi outbound list\n```\n\n### Ver detalhes da fila\n```bash\nravi outbound show <id>\n```\n\n### Criar fila\n```bash\nravi outbound create \"<nome>\" --instructions \"<prompt>\" --every <interval> --stages '<json>'\n```\n\nOp√ß√µes obrigat√≥rias:\n- `--instructions <text>` - Instru√ß√µes do agent\n- `--every <interval>` - Intervalo entre entries (ex: 5m, 1h)\n- `--stages <json>` - Pipeline stages (ver se√ß√£o abaixo)\n\nOp√ß√µes extras:\n- `--agent <id>` - Agent que processa\n- `--description <text>` - Descri√ß√£o da fila\n- `--active-start <HH:MM>` - Hor√°rio in√≠cio (ex: 09:00)\n- `--active-end <HH:MM>` - Hor√°rio fim (ex: 22:00)\n- `--tz <timezone>` - Fuso hor√°rio\n- `--max-rounds <n>` - M√°ximo de rounds por entry\n\n### Iniciar/Pausar fila\n```bash\nravi outbound start <id>\nravi outbound pause <id>\n```\n\n### Configurar propriedades\n```bash\nravi outbound set <id> <key> <value>\n```\nKeys: name, instructions, every, agent, description, active-start, active-end, tz, stages, max-rounds\n\n### Deletar fila\n```bash\nravi outbound rm <id>\n```\n\n### Executar manualmente\n```bash\nravi outbound run <id>\n```\n\n## Comandos de Entries\n\n### Adicionar entry\n```bash\nravi outbound add <queueId> <phone> --name \"Nome\" --context '{\"empresa\":\"Acme\"}'\n```\n\nOu adicionar por tag:\n```bash\nravi outbound add <queueId> - --tag \"leads\"\n```\n\n### Listar entries\n```bash\nravi outbound entries <queueId>\n```\n\n### Ver status de entry\n```bash\nravi outbound status <entryId>\n```\n\n### Ver hist√≥rico de chat\n```bash\nravi outbound chat <entryId>\n```\n\n### Atualizar contexto\n```bash\nravi outbound context <entryId> '{\"empresa\":\"Nova Info\"}'\n```\n\n### Qualificar lead / Mudar est√°gio\n```bash\nravi outbound qualify <entryId> <stage>\n```\nAceita qualquer est√°gio definido na fila. Cada fila define seus pr√≥prios est√°gios.\n\n### Marcar como conclu√≠do\n```bash\nravi outbound done <entryId>\nravi outbound complete <entryId>\nravi outbound skip <entryId>\n```\n\n### Resetar entry\n```bash\nravi outbound reset <entryId>\nravi outbound reset <entryId> --full  # Limpa contexto tamb√©m\n```\n\n## Relat√≥rio Completo\n\n```bash\nravi outbound report              # Todas as filas\nravi outbound report <queueId>    # Fila espec√≠fica\n```\n\n## Enviar Mensagem Manual\n\n```bash\nravi outbound send <entryId> \"Mensagem\"\n```\n\nOp√ß√µes:\n- `--account <id>` - Conta WhatsApp\n- `--typing-delay <ms>` - Delay de digita√ß√£o\n- `--pause <ms>` - Pausa antes de digitar\n\n## Pipeline Stages\n\nCada fila **deve** definir seus pr√≥prios est√°gios. N√£o existe padr√£o ‚Äî defina o funil que faz sentido pro caso de uso.\n\n### Formato\n```json\n[\n  { \"name\": \"novo\" },\n  { \"name\": \"engajado\", \"delay\": 30 },\n  { \"name\": \"qualificado\" },\n  { \"name\": \"perdido\" }\n]\n```\n\n- `name` ‚Äî identificador do est√°gio\n- `delay` ‚Äî minutos para follow-up autom√°tico (null/omitido = sem follow-up)\n\n### Exemplos por caso de uso\n\n**Vendas B2B:**\n```bash\nravi outbound create \"Prospec√ß√£o\" --instructions \"...\" --every 5m \\\n  --stages '[{\"name\":\"cold\"},{\"name\":\"engajado\",\"delay\":30},{\"name\":\"reuniao_marcada\",\"delay\":1440},{\"name\":\"proposta\",\"delay\":4320},{\"name\":\"fechado\"},{\"name\":\"perdido\"}]'\n```\n\n**Recrutamento:**\n```bash\nravi outbound set <id> stages '[{\"name\":\"novo\"},{\"name\":\"respondeu\",\"delay\":30},{\"name\":\"interessado\",\"delay\":60},{\"name\":\"agendou_entrevista\",\"delay\":1440},{\"name\":\"contratado\"},{\"name\":\"recusou\"}]'\n```\n\n**Cobran√ßa:**\n```bash\nravi outbound set <id> stages '[{\"name\":\"aviso\"},{\"name\":\"lembrete\",\"delay\":1440},{\"name\":\"urgente\",\"delay\":2880},{\"name\":\"ultima_chance\",\"delay\":4320},{\"name\":\"inadimplente\"}]'\n```\n\n### Como funciona\n- O agent recebe os est√°gios dispon√≠veis no prompt automaticamente\n- `qualify` valida contra os est√°gios da fila\n- Follow-up autom√°tico usa o `delay` do est√°gio atual da entry\n"
      },
      {
        "path": "skills/matrix/SKILL.md",
        "content": "---\nname: matrix-manager\ndescription: |\n  Gerencia contas e comunica√ß√£o Matrix. Use quando o usu√°rio quiser:\n  - Adicionar, listar ou remover contas Matrix\n  - Enviar mensagens via Matrix\n  - Ver ou criar salas/rooms\n  - Convidar usu√°rios para salas\n  - Verificar status de conex√£o\n---\n\n# Matrix Manager\n\nMatrix √© um protocolo de mensagens federado. Ravi usa Matrix para comunica√ß√£o entre agents e usu√°rios.\n\n## Gerenciamento de Contas\n\n### Listar contas\n```bash\nravi matrix users-list\n```\n\n### Adicionar conta (login ou registro)\n```bash\nravi matrix users-add <username> -p <password>\nravi matrix users-add <username> -p <password> -h https://matrix.org\n```\n\n### Remover conta\n```bash\nravi matrix users-remove <username>\n```\n\n### Verificar identidade\n```bash\nravi matrix whoami <account>\n```\n\n### Status de conex√£o\n```bash\nravi matrix status\nravi matrix status <agent>\n```\n\n## Contas de Agents\n\nAgents podem ter contas Matrix associadas:\n\n### Registrar conta pra agent\n```bash\nravi matrix register <agent>\nravi matrix register <agent> -h http://localhost:8008 -u username -p password\n```\n\n### Login de agent\n```bash\nravi matrix login <agent>\n```\n\n### Logout de agent\n```bash\nravi matrix logout <agent>\n```\n\n### Listar contas de agents\n```bash\nravi matrix accounts\n```\n\n## Salas (Rooms)\n\n### Listar salas\n```bash\nravi matrix rooms <account>\n```\n\n### Criar sala\n```bash\nravi matrix create-room <account> \"Nome da Sala\"\nravi matrix create-room <account> \"Sala P√∫blica\" --public\nravi matrix create-room <account> \"Com Alias\" --alias minha-sala\nravi matrix create-room <account> \"Com Convite\" --invite @user:server\n```\n\n### Entrar em sala\n```bash\nravi matrix join <account> <room_id>\nravi matrix join <account> \"#alias:server\"\n```\n\n### Convidar pra sala\n```bash\nravi matrix invite <target_user> <room_id> --from <account>\n```\n\n### Criar DM\n```bash\nravi matrix dm <from_account> <to_account_or_user>\n```\n\n## Mensagens\n\n### Ver mensagens\n```bash\nravi matrix messages <account> <room_id>\nravi matrix messages <account> <room_id> --limit 50\n```\n\n### Enviar mensagem\n```bash\nravi matrix send <account> <room_id> \"Mensagem\"\nravi matrix send <account> @user:server \"DM direto\"\n```\n\n## Exemplos\n\nCriar conta e enviar mensagem:\n```bash\nravi matrix users-add bot -p senha123\nravi matrix send bot \"#geral:localhost\" \"Ol√°!\"\n```\n\nConfigurar agent com Matrix:\n```bash\nravi matrix register meu-agent -h http://localhost:8008\nravi agents set meu-agent matrixAccount meu-agent\nravi daemon restart\n```\n\nCriar sala privada entre agents:\n```bash\nravi matrix create-room agent1 \"Discuss√£o\" --invite @agent2:localhost\nravi matrix join agent2 \"!roomid:localhost\"\n```\n"
      },
      {
        "path": "skills/routes/SKILL.md",
        "content": "---\nname: routes-manager\ndescription: |\n  Gerencia rotas de mensagens do Ravi. Use quando o usu√°rio quiser:\n  - Criar, listar ou remover rotas\n  - Direcionar contatos/grupos para agents espec√≠ficos\n  - Configurar prioridade de rotas\n  - Ver qual agent atende qual padr√£o\n---\n\n# Routes Manager\n\nRotas direcionam mensagens para agents baseado em padr√µes. Um contato ou grupo pode ser roteado para um agent espec√≠fico.\n\n## Comandos\n\n### Listar rotas\n```bash\nravi routes list\n```\n\n### Ver detalhes\n```bash\nravi routes show <pattern>\n```\n\n### Adicionar rota\n```bash\nravi routes add <pattern> <agent>\n```\n\nExemplos de padr√µes:\n- `5511*` - Todos com DDD 11\n- `*999*` - N√∫meros contendo 999\n- `group:123456` - Grupo espec√≠fico do WhatsApp\n- `*` - Catch-all (fallback)\n\n### Remover rota\n```bash\nravi routes remove <pattern>\n```\n\n### Configurar propriedades\n```bash\nravi routes set <pattern> <key> <value>\n```\n\nKeys:\n- `priority` - Prioridade (maior = mais priorit√°rio)\n- `dmScope` - Escopo de DM (main, per-peer, etc)\n\n## Prioridade de Resolu√ß√£o\n\n1. Contato com agent atribu√≠do diretamente\n2. Rota que casa com o padr√£o (por prioridade)\n3. AccountId = AgentId\n4. Agent default\n\n## Exemplos\n\nRotear grupo para agent especializado:\n```bash\nravi routes add \"group:120363123456789@g.us\" projeto-x\n```\n\nRotear todos de SP para agent:\n```bash\nravi routes add \"5511*\" vendas\n```\n\nDefinir fallback:\n```bash\nravi routes add \"*\" main\n```\n\n## Rela√ß√£o com Contacts\n\nRoutes e Contacts trabalham juntos no roteamento:\n\n- **Contacts** podem ter `agent_id` atribu√≠do diretamente (via `ravi contacts set <phone> agent <agent>` ou `ravi contacts approve <phone> <agent>`)\n- **Routes** definem regras por padr√£o (prefixo, grupo, catch-all)\n- Na resolu√ß√£o, `contact.agent_id` tem prioridade sobre routes\n- `ravi routes list` mostra o nome e status do contato associado a cada padr√£o\n- Para gerenciar contatos: use a skill `ravi-system:contacts`\n"
      },
      {
        "path": "skills/whatsapp/SKILL.md",
        "content": "---\nname: whatsapp-manager\ndescription: |\n  Gerencia funcionalidades do WhatsApp via Baileys. Use quando o usu√°rio quiser:\n  - Criar, gerenciar ou sair de grupos\n  - Adicionar/remover membros de grupos\n  - Gerar ou revogar links de convite\n  - Renomear grupos ou mudar descri√ß√£o\n  - Alterar configura√ß√µes de grupo (an√∫ncio, locked)\n  - Entrar em grupo via link de convite\n  - Listar todos os grupos que o bot participa\n---\n\n# WhatsApp Manager\n\nFuncionalidades do WhatsApp expostas via Baileys. Permite gerenciar grupos, membros, convites e configura√ß√µes diretamente pelo CLI.\n\n**Importante:** Todos os comandos precisam que o daemon esteja rodando com WhatsApp conectado. Os comandos se comunicam com o daemon via notif (request/reply).\n\n## Gerenciamento de Grupos\n\n### Listar grupos\n```bash\nravi whatsapp group list\n```\n\n### Ver info de um grupo\n```bash\nravi whatsapp group info <groupId>\n```\n\nO `groupId` aceita:\n- JID completo: `120363425628305127@g.us`\n- Formato normalizado: `group:120363425628305127`\n\n### Criar grupo\n```bash\nravi whatsapp group create \"Nome do Grupo\" \"5511999999999,5511888888888\"\n```\n\nParticipantes separados por v√≠rgula. Aceita n√∫meros de telefone ou JIDs.\n\n**Com agent (recomendado):** Auto-aprova o contato e cria a rota pro agent num comando s√≥:\n```bash\nravi whatsapp group create \"Vida - Health\" \"5511947879044\" --agent health\n```\n\nSa√≠da:\n```\n‚úì Group created: Vida - Health\n  ID:           120363405113391144@g.us\n  Participants: 2\n  Contact:      approved\n  Route:        health\n```\n\n### Sair de um grupo\n```bash\nravi whatsapp group leave <groupId>\n```\n\n## Membros\n\n### Adicionar participantes\n```bash\nravi whatsapp group add <groupId> \"5511999999999,5511888888888\"\n```\n\n### Remover participantes\n```bash\nravi whatsapp group remove <groupId> \"5511999999999\"\n```\n\n### Promover a admin\n```bash\nravi whatsapp group promote <groupId> \"5511999999999\"\n```\n\n### Remover admin\n```bash\nravi whatsapp group demote <groupId> \"5511999999999\"\n```\n\n## Convites\n\n### Gerar link de convite\n```bash\nravi whatsapp group invite <groupId>\n```\n\nRetorna o link `https://chat.whatsapp.com/...`\n\n### Revogar link (gera novo)\n```bash\nravi whatsapp group revoke-invite <groupId>\n```\n\n### Entrar via link\n```bash\nravi whatsapp group join \"https://chat.whatsapp.com/ABC123\"\n# ou s√≥ o c√≥digo:\nravi whatsapp group join ABC123\n```\n\n## Configura√ß√µes\n\n### Renomear grupo\n```bash\nravi whatsapp group rename <groupId> \"Novo Nome\"\n```\n\n### Mudar descri√ß√£o\n```bash\nravi whatsapp group description <groupId> \"Nova descri√ß√£o do grupo\"\n```\n\n### Alterar settings\n```bash\nravi whatsapp group settings <groupId> <setting>\n```\n\nSettings dispon√≠veis:\n- `announcement` ‚Äî s√≥ admins enviam mensagens\n- `not_announcement` ‚Äî todos enviam mensagens\n- `locked` ‚Äî s√≥ admins editam info do grupo\n- `unlocked` ‚Äî todos editam info do grupo\n\n## Multi-account\n\nTodos os comandos aceitam `--account <id>` pra especificar qual conta WhatsApp usar. Default: `default`.\n\n```bash\nravi whatsapp group list --account business\nravi whatsapp group create \"Equipe\" \"5511999\" --account business\n```\n\n## Exemplos Pr√°ticos\n\n### Criar grupo pra um agent\n```bash\n# Tudo num comando s√≥:\nravi whatsapp group create \"Vida - Finan√ßas\" \"5511947879044\" --agent financas\n```\n\nSem `--agent`, o grupo √© criado e aprovado automaticamente, mas sem rota ‚Äî precisa rotear manualmente:\n```bash\nravi whatsapp group create \"Grupo Avulso\" \"5511999999999\"\nravi routes add group:<id> meu-agent\n```\n\n### Gerenciar membros de equipe\n```bash\n# Ver quem t√° no grupo\nravi whatsapp group info group:120363425628305127\n\n# Adicionar novo membro\nravi whatsapp group add group:120363425628305127 \"5511777777777\"\n\n# Promover a admin\nravi whatsapp group promote group:120363425628305127 \"5511777777777\"\n```\n\n### Gerar convite tempor√°rio\n```bash\n# Gerar link\nravi whatsapp group invite group:120363425628305127\n# ‚Üí https://chat.whatsapp.com/ABC123\n\n# Depois de todos entrarem, revogar\nravi whatsapp group revoke-invite group:120363425628305127\n```\n"
      },
      {
        "path": "skills/cron/SKILL.md",
        "content": "---\nname: cron-manager\ndescription: |\n  Gerencia jobs agendados do sistema Ravi. Use quando o usu√°rio quiser:\n  - Criar, listar ou deletar tarefas agendadas\n  - Configurar cron expressions, intervalos ou hor√°rios espec√≠ficos\n  - Ativar/desativar jobs existentes\n  - Executar jobs manualmente\n---\n\n# Cron Manager\n\nVoc√™ gerencia os jobs agendados do Ravi. Jobs s√£o tarefas que rodam automaticamente em hor√°rios ou intervalos espec√≠ficos.\n\n## Tipos de Schedule\n\n| Tipo | Exemplo | Descri√ß√£o |\n|------|---------|-----------|\n| `--cron` | `\"0 9 * * *\"` | Cron expression (todo dia 9h) |\n| `--every` | `30m`, `1h`, `2h30m` | Intervalo fixo |\n| `--at` | `2025-02-01T15:00` | Hor√°rio √∫nico (one-shot) |\n\n## Comandos Dispon√≠veis\n\n### Listar jobs\n```bash\nravi cron list\n```\n\n### Ver detalhes\n```bash\nravi cron show <id>\n```\n\n### Criar job\n\nCom cron expression:\n```bash\nravi cron add \"Relat√≥rio Di√°rio\" --cron \"0 9 * * *\" --message \"Gere o relat√≥rio di√°rio\"\n```\n\nCom intervalo:\n```bash\nravi cron add \"Check Emails\" --every 30m --message \"Verifique novos emails\"\n```\n\nOne-shot (executa uma vez):\n```bash\nravi cron add \"Lembrete\" --at \"2025-02-01T15:00\" --message \"Lembrar de X\" --delete-after\n```\n\nOp√ß√µes:\n- `--agent <id>` - Agent que executa\n- `--tz <timezone>` - Fuso hor√°rio (ex: America/Sao_Paulo)\n- `--isolated` - Roda em sess√£o isolada\n- `--delete-after` - Deleta ap√≥s primeira execu√ß√£o\n- `--description <text>` - Descri√ß√£o do job\n\n### Ativar/Desativar\n```bash\nravi cron enable <id>\nravi cron disable <id>\n```\n\n### Configurar propriedades\n```bash\nravi cron set <id> <key> <value>\n```\n\nKeys: name, message, cron, every, tz, agent, description, session, delete-after\n\n### Executar manualmente\n```bash\nravi cron run <id>\n```\n\n### Deletar\n```bash\nravi cron rm <id>\n```\n\n## Cron Expression Reference\n\n```\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ minuto (0-59)\n‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ hora (0-23)\n‚îÇ ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ dia do m√™s (1-31)\n‚îÇ ‚îÇ ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ m√™s (1-12)\n‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ dia da semana (0-6, 0=domingo)\n‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îÇ\n* * * * *\n```\n\nExemplos:\n- `0 9 * * *` - Todo dia √†s 9h\n- `0 9 * * 1-5` - Dias √∫teis √†s 9h\n- `*/15 * * * *` - A cada 15 minutos\n- `0 0 1 * *` - Primeiro dia do m√™s √† meia-noite\n- `0 18 * * 5` - Toda sexta √†s 18h\n\n## Exemplos\n\nRelat√≥rio semanal toda segunda:\n```bash\nravi cron add \"Weekly Report\" --cron \"0 9 * * 1\" --message \"Gere relat√≥rio semanal\" --tz \"America/Sao_Paulo\"\n```\n\nVerifica√ß√£o a cada 2 horas:\n```bash\nravi cron add \"Health Check\" --every 2h --message \"Verifique status dos sistemas\"\n```\n\nLembrete √∫nico:\n```bash\nravi cron add \"Reuni√£o\" --at \"2025-01-30T14:00\" --message \"Lembrar: reuni√£o em 15min\" --delete-after\n```\n"
      },
      {
        "path": "skills/channels/SKILL.md",
        "content": "---\nname: channels-manager\ndescription: |\n  Gerencia canais de comunica√ß√£o do Ravi. Use quando o usu√°rio quiser:\n  - Ver status dos canais (WhatsApp, Matrix)\n  - Iniciar, parar ou reiniciar canais\n  - Verificar conex√£o do WhatsApp\n  - Troubleshoot problemas de conex√£o\n---\n\n# Channels Manager\n\nCanais s√£o as interfaces de comunica√ß√£o (WhatsApp, Matrix, etc).\n\n## Comandos\n\n### Ver status\n```bash\nravi channels status\nravi channels status whatsapp\nravi channels status matrix\n```\n\n### Listar canais\n```bash\nravi channels list\n```\n\n### Iniciar canal\n```bash\nravi channels start <target>\n```\n\n### Parar canal\n```bash\nravi channels stop <target>\n```\n\n### Reiniciar canal\n```bash\nravi channels restart <target>\n```\n\n## Targets\n\n- `whatsapp` - Gateway WhatsApp\n- `matrix` - Gateway Matrix\n- `<accountId>` - Conta espec√≠fica\n\n## Troubleshooting\n\n### WhatsApp desconectado\n```bash\nravi channels status whatsapp\nravi channels restart whatsapp\n```\n\n### Ver QR code novamente\n```bash\nravi service wa\n```\n\n### Matrix n√£o conecta\n```bash\nravi channels status matrix\nravi matrix status\n```\n"
      }
    ]
  },
  {
    "name": "ravi-dev",
    "manifest": {
      "name": "ravi-dev",
      "version": "1.0.0",
      "description": "Ravi meta-development skills - architecture docs, prompt system, and internal patterns"
    },
    "files": [
      {
        "path": ".claude-plugin/plugin.json",
        "content": "{\n  \"name\": \"ravi-dev\",\n  \"version\": \"1.0.0\",\n  \"description\": \"Ravi meta-development skills - architecture docs, prompt system, and internal patterns\"\n}\n"
      },
      {
        "path": "skills/architecture/SKILL.md",
        "content": "---\nname: ravi-architecture\ndescription: |\n  Documentacao completa da arquitetura do Ravi. Use quando precisar:\n  - Entender como o sistema funciona end-to-end\n  - Modificar componentes existentes\n  - Adicionar novos subsistemas\n  - Debugar fluxos de mensagem\n  - Onboarding no codebase\n---\n\n# Ravi - Arquitetura do Sistema\n\nRavi e um sistema multi-agent construido sobre o Claude Agent SDK que orquestra conversas em multiplas plataformas (WhatsApp, Matrix, TUI).\n\n**Repositorio:** `/Users/luis/dev/filipelabs/ravi.bot`\n**Runtime:** Bun | **DB:** SQLite | **PubSub:** notif.sh | **AI:** Claude SDK\n\n## Fluxo Principal de Mensagens\n\n```\n[WhatsApp/Matrix/TUI]\n    -> Channel Plugin (normaliza mensagem)\n    -> Gateway (formata envelope, resolve rota)\n    -> notif.emit(\"ravi.{sessionKey}.prompt\")\n    -> RaviBot (Claude SDK query)\n    -> notif.emit(\"ravi.{sessionKey}.response\")\n    -> Gateway (roteia para canal)\n    -> [WhatsApp/Matrix/TUI]\n```\n\n## Componentes Core\n\n### daemon.ts - Ponto de Entrada\nOrquestra startup de todos os subsistemas:\n1. Carrega env de `~/.ravi/.env`\n2. Inicia RaviBot (Claude SDK)\n3. Cria Gateway com channel plugins\n4. Registra WhatsApp + Matrix\n5. Inicia HeartbeatRunner, CronRunner, OutboundRunner, TriggerRunner\n\n### gateway.ts - Orquestrador de Mensagens\n**Inbound:** Channel normaliza msg -> Gateway resolve rota -> emite prompt\n**Outbound:** Bot emite response -> Gateway extrai target -> envia pro canal\n\nSubscriptions importantes:\n- `{channelId}.*.inbound` - Msgs dos canais\n- `ravi.*.response` - Respostas do bot\n- `ravi.outbound.deliver` - Envio direto do outbound\n- `ravi.media.send` - Envio de midia\n\nFeatures:\n- Ghost detection via `_emitId` (previne duplicatas de restarts)\n- Typing indicator automatico\n- Outbound suppression (msgs de contatos outbound nao geram prompt)\n\n### bot.ts - Core do Bot\nProcessa prompts usando Claude Agent SDK.\n\n**Fluxo:**\n1. Subscribe em `ravi.*.prompt`\n2. Resolve agent config pela session key\n3. Debounce se configurado\n4. Cria/resume SDK session\n5. Streama resposta -> emite responses parciais\n6. Gerencia interrupts (msg nova durante processamento)\n\n**Interrupt handling:**\n- Tool rodando -> enfileira msg\n- Sem tool -> aborta query atual\n- Apos tool terminar -> checa fila -> interrupt\n- Msgs enfileiradas sao combinadas em 1 prompt\n\n**Abort control:**\n- Cada sessao tem AbortController\n- Novo prompt aborta subprocess anterior\n- Daemon stop aborta TODOS os controllers\n- Watchdog de 5min detecta sessoes travadas\n\n### router/ - Sistema de Roteamento\n\n**Resolucao de rota (prioridade):**\n1. Agent atribuido ao contato\n2. Rota com pattern match\n3. AccountId = AgentId (Matrix)\n4. Agent default\n\n**Session keys:**\n```\nagent:{agentId}:{scope}:{peerId}\nagent:main:main                          # Todas DMs (scope=main)\nagent:main:dm:5511999                    # Por contato\nagent:main:whatsapp:group:123456         # Grupo\nagent:main:outbound:queueId:phone        # Outbound\n```\n\n**DM Scopes:**\n- `main` - Todas DMs compartilham 1 sessao\n- `per-peer` - Isolado por contato (default)\n- `per-channel-peer` - Isolado por canal+contato\n- `per-account-channel-peer` - Isolamento total\n\n**Arquivos:**\n- `router/resolver.ts` - Resolve rota -> session key\n- `router/session-key.ts` - Constroi/parseia session keys\n- `router/sessions.ts` - CRUD de sessoes (SQLite)\n- `router/config.ts` - Carrega config de agents/routes\n- `router/router-db.ts` - Camada de banco\n\n### channels/ - Abstracao de Canais\n\nInterface unificada para plataformas de mensagem.\n\n**Adapters:**\n- ConfigAdapter - Configuracao de contas\n- SecurityAdapter - Controle de acesso\n- OutboundAdapter - Envio de msgs, typing, reactions\n- GatewayAdapter - Lifecycle de conexao\n- StatusAdapter - Health monitoring\n\n**WhatsApp (`channels/whatsapp/`):**\n- Baileys SDK, multi-account, QR pairing\n- Media download com limites de tamanho\n- Transcricao de audio (OpenAI Whisper)\n- JID/LID resolution\n- Sessao em `~/ravi/sessions/whatsapp/{accountId}/`\n\n**Matrix (`channels/matrix/`):**\n- matrix-bot-sdk, multi-account\n- E2E encryption, device verification\n- Credenciais em `~/ravi/sessions/matrix/accounts.json`\n- Cada agent pode ter matrixAccount diferente\n\n## Subsistemas de Automacao\n\n### Outbound (`outbound/`)\nCampanhas de mensagens proativas com processamento round-robin.\n\n**Fluxo:**\n1. Runner pega proxima queue do DB\n2. Arma timer para `nextRunAt`\n3. Processa entries por prioridade:\n   - Response entries (contato respondeu)\n   - Follow-up entries (sem resposta, precisa follow-up)\n   - Initial outreach (entries pendentes)\n4. Manda prompt para agent com contexto da campanha\n\n**Qualificacao:** cold -> warm -> interested -> qualified/rejected\n\n### Triggers (`triggers/`)\nAutomacao event-driven disparada por eventos do sistema.\n\n**Fluxo:**\n1. Runner subscribe em topics configurados\n2. Evento dispara -> busca triggers ativos com match\n3. Emite prompt para sessao target do trigger\n4. Respeita cooldown entre disparos\n\n### Cron (`cron/`)\nJobs agendados com suporte a multiplos formatos.\n\n**Schedules:** cron expression | interval (\"30m\") | daily (\"09:00\") | at (one-time)\n\n**Fluxo:** Timer -> job due -> emite prompt -> calcula proximo run\n\n### Heartbeat (`heartbeat/`)\nCheck-ins periodicos de agents dentro de horarios ativos.\n\n**Fluxo:**\n1. Checa agents com heartbeat enabled\n2. Para cada sessao, verifica se esta due\n3. Checa active hours (timezone-aware)\n4. Envia prompt de status check\n5. `HEARTBEAT_OK` = silencioso, qualquer outro texto = envia pro canal\n\n### Session Messaging (`cli/commands/sessions.ts`)\nMensagens entre sessoes (inter-session communication).\n\n**Comandos:** `sessions send` | `sessions inform` | `sessions execute` | `sessions ask` | `sessions answer`\n\n**Ask/Answer flow:**\n1. Agent A: `ravi sessions ask <target-session> \"pergunta\" \"sender\"`\n2. Bot emite `[System] Ask:` para target\n3. Agent B responde, usa `ravi sessions answer <origin-session> \"resposta\" \"sender\"`\n4. Bot emite `[System] Answer:` para origin\n\n## Sistema de Plugins\n\n**Duas fontes:**\n1. **Internos** - Embutidos no build, extraidos para `~/.cache/ravi/plugins/`\n2. **Usuario** - Customizados em `~/ravi/plugins/`\n\n**Build time:** `gen-plugins.ts` escaneia `src/plugins/internal/` e gera `internal-registry.ts`\n**Runtime:** `discoverPlugins()` extrai internos + escaneia user dir -> passa para SDK\n\n## Sistema de Hooks\n\n### PreToolUse (bash/hook.ts)\nIntercepta chamadas Bash e valida contra BashConfig do agent.\nModos: bypass | allowlist | denylist\n\n### PreCompact (hooks/pre-compact.ts)\nExtrai memorias antes do SDK compactar contexto.\nLe `COMPACT_INSTRUCTIONS.md` do agent, roda modelo barato em background, atualiza `MEMORY.md`.\n\n## Infraestrutura CLI\n\n### Decorators\n```typescript\n@Group({ name: \"agents\" })\nclass AgentCommands {\n  @Command({ name: \"list\" })\n  list() { ... }\n\n  @Command({ name: \"create\" })\n  create(@Arg(\"id\") id: string) { ... }\n}\n```\n\n### Contexto (AsyncLocalStorage)\n```typescript\nrunWithContext({ sessionKey, agentId, source }, async () => {\n  // CLI tools acessam contexto sem parametros\n  const ctx = getContext();\n});\n```\n\n## Storage\n\n```\n~/ravi/ravi.db          - SQLite: agents, routes, sessions, contacts, settings\n~/.ravi/.env            - API keys e env vars\n~/.ravi/logs/           - Logs do daemon\n~/ravi/{agent-id}/      - Diretorios dos agents (CLAUDE.md, MEMORY.md)\n~/ravi/sessions/        - Sessoes dos canais (WhatsApp, Matrix)\n~/.cache/ravi/plugins/  - Plugins internos extraidos\n~/.claude/sessions/     - SDK session files (JSONL)\n```\n\n## Padroes Importantes\n\n1. **PubSub via notif** - Tudo comunica via topics\n2. **Ghost detection** - `_emitId` + `_instanceId` previne duplicatas\n3. **Abort control** - AbortController por sessao, cleanup no stop\n4. **Debouncing** - Agrupa msgs rapidas por window configuravel\n5. **Outbound suppression** - Msgs de contatos outbound nao geram prompt duplicado\n6. **Silent token** - `@@SILENT@@` suprime emissao pro canal\n7. **Session resumption** - SDK sessions persistem entre mensagens\n"
      },
      {
        "path": "skills/prompt-builder/SKILL.md",
        "content": "---\nname: prompt-builder\ndescription: |\n  Documenta o sistema de construcao de prompts do Ravi. Use quando precisar:\n  - Entender como system prompts sao montados\n  - Adicionar novas secoes ao prompt\n  - Modificar formatacao por canal\n  - Entender injecao de contexto (grupo, reactions, runtime)\n  - Criar novas regras de output por plataforma\n---\n\n# Prompt Builder - Sistema de Injecao de Contexto\n\nO prompt builder constroi o system prompt appendix que e injetado em cada chamada do Claude SDK.\nEle adapta o comportamento do agent baseado no canal, grupo, e contexto da mensagem.\n\n**Arquivo:** `src/prompt-builder.ts`\n\n## Como Funciona\n\n```typescript\n// bot.ts - na hora de processar prompt\nconst systemPromptAppend = buildSystemPrompt(agent.id, prompt.context);\n\nquery({\n  prompt: prompt.prompt,\n  options: {\n    systemPrompt: {\n      type: \"preset\",\n      preset: \"claude_code\",\n      append: systemPromptAppend,  // <-- injetado aqui\n    },\n  },\n});\n```\n\nO SDK usa o preset `claude_code` como base e appenda nossas secoes.\n\n## Estrutura do Builder\n\n```typescript\nclass PromptBuilder {\n  section(title: string, content: string): this;\n  build(): string;  // Retorna \"## Title\\n\\nContent\" para cada secao\n}\n```\n\n## Secoes Injetadas\n\nA funcao `buildSystemPrompt(agentId, ctx)` monta as secoes:\n\n### 1. Identidade (sempre)\n```\n## Identidade\nVoce e Ravi.\n```\n\n### 2. System Commands (sempre)\nProtocolo de comandos internos:\n- `[System] Inform: <info>` - Avalie a info e decida: sil√™ncio (@@SILENT@@), resposta breve, ou a√ß√£o com tools\n- `[System] Execute: <task>` - Execute usando tools\n- `[System] Ask: [from: <session>] <question>` - Pergunta cross-session\n- `[System] Answer: [from: <session>] <response>` - Resposta cross-session\n- *(relay n√£o tem prefixo ‚Äî chega como mensagem normal)*\n\n### 3. Runtime (quando tem contexto de canal)\n```\nRuntime: agent=main | channel=WhatsApp | capabilities=polls,reactions\n```\n\n### 4. Output Formatting (quando tem contexto de canal)\nFormatacao adaptada por plataforma:\n\n**WhatsApp:**\n- Listas com emojis numerados (1, 2, 3)\n- Icones visuais para hierarquia\n- Status com check/x\n- Sem tabelas markdown\n- Conciso (telas mobile)\n\n**Matrix:**\n- Markdown rico (tabelas, negrito, codigo)\n\n**TUI:**\n- ASCII tables (| - +)\n\n### 5. Reactions (quando tem contexto de canal)\nInstrucoes de quando usar emoji reactions vs texto:\n- Prefira emoji sobre \"ok\", \"entendi\", \"beleza\"\n- Use `react_send` com o `[mid:ID]` da mensagem\n- Nao reaja E responda ao mesmo tempo\n\n### 6. Contexto de Grupo (quando isGroup=true)\n```\nVoce esta respondendo no grupo \"Familia\".\nMembros: Joao, Maria, Luis.\nSeja seletivo: responda so quando mencionado ou claramente util.\nSe nao precisa responder: @@SILENT@@\n```\n\n## Fluxo de Contexto\n\n```\nWhatsApp msg recebida\n    -> Channel normaliza -> InboundMessage\n    -> Gateway extrai MessageContext:\n       { channelId, channelName, senderId, isGroup, groupName, groupMembers, ... }\n    -> Emite para bot com context\n    -> bot.ts chama buildSystemPrompt(agentId, context)\n    -> Prompt appendix montado com secoes relevantes\n    -> Passado para Claude SDK\n```\n\n## MessageContext (origem)\n\n```typescript\ninterface MessageContext {\n  channelId: string;       // \"whatsapp\"\n  channelName: string;     // \"WhatsApp\"\n  accountId: string;       // \"default\"\n  chatId: string;          // \"5511999999999\"\n  messageId: string;       // ID da msg\n  senderId: string;        // Quem mandou\n  senderName?: string;     // Nome do remetente\n  senderPhone?: string;    // Telefone\n  isGroup: boolean;\n  groupName?: string;\n  groupId?: string;\n  groupMembers?: string[];\n  timestamp: number;\n}\n```\n\n## ChannelContext (persistido)\n\nMetadados estaveis que sao salvos na sessao para reuso:\n\n```typescript\ninterface ChannelContext {\n  channelId: string;\n  channelName: string;\n  isGroup: boolean;\n  groupName?: string;\n  groupId?: string;\n  groupMembers?: string[];\n}\n```\n\nSalvo em `sessions.last_context` como JSON. Usado pelo cross-send para reconstruir contexto.\n\n## Silent Token\n\n```typescript\nexport const SILENT_TOKEN = \"@@SILENT@@\";\n```\n\nQuando o agent responde com este token:\n- Gateway NAO envia para o canal\n- Bot emite evento `{ type: \"silent\" }` para parar typing\n- Usado em grupos quando nao precisa responder\n\n## Como Adicionar uma Nova Secao\n\n1. Crie a funcao no `prompt-builder.ts`:\n```typescript\nfunction minhaSecao(ctx: ChannelContext): string {\n  return `Instrucoes especificas aqui...`;\n}\n```\n\n2. Adicione ao builder em `buildSystemPrompt()`:\n```typescript\nbuilder.section(\"Minha Secao\", minhaSecao(ctx));\n```\n\n3. Rebuild e reinicie o daemon.\n\n## Como Adicionar Formatacao para Novo Canal\n\n1. Adicione um case em `outputFormattingText()`:\n```typescript\nif (channelName === \"MeuCanal\") {\n  return `Regras de formatacao para MeuCanal...`;\n}\n```\n\n2. O channelName vem do `ChannelPlugin.meta.name`.\n\n## Outbound System Context\n\nO sistema de outbound injeta contexto adicional via `prompt._outboundSystemContext`:\n```typescript\nif (prompt._outboundSystemContext) {\n  systemPromptAppend += \"\\n\\n\" + prompt._outboundSystemContext;\n}\n```\n\nIsso inclui:\n- Instrucoes da queue\n- Tools disponiveis (outbound_send, outbound_qualify, etc)\n- Workflow de qualificacao\n- Metadata da entry (ID, round, qualification)\n"
      }
    ]
  }
];

/** Get internal plugin by name */
export function getInternalPlugin(name: string): InternalPlugin | undefined {
  return INTERNAL_PLUGINS.find(p => p.name === name);
}

/** Get all internal plugin names */
export function getInternalPluginNames(): string[] {
  return INTERNAL_PLUGINS.map(p => p.name);
}
