/**
 * Internal Plugins Registry (auto-generated)
 *
 * DO NOT EDIT - This file is generated by scripts/gen-plugins.ts
 * Run: bun run gen:plugins
 *
 * Contains embedded plugin data for: ravi-system, ravi-dev
 */

export interface PluginFile {
  path: string;
  content: string;
}

export interface InternalPlugin {
  name: string;
  manifest: Record<string, unknown>;
  files: PluginFile[];
}

/** Embedded internal plugins */
export const INTERNAL_PLUGINS: InternalPlugin[] = [
  {
    "name": "ravi-system",
    "manifest": {
      "name": "ravi-system",
      "version": "1.0.0",
      "description": "Ravi system management skills - agents, contacts, triggers, routes, and more"
    },
    "files": [
      {
        "path": ".claude-plugin/plugin.json",
        "content": "{\n  \"name\": \"ravi-system\",\n  \"version\": \"1.0.0\",\n  \"description\": \"Ravi system management skills - agents, contacts, triggers, routes, and more\"\n}\n"
      },
      {
        "path": "skills/settings/SKILL.md",
        "content": "---\nname: settings-manager\ndescription: |\n  Gerencia configurações globais do Ravi. Use quando o usuário quiser:\n  - Ver ou alterar configurações do sistema\n  - Definir agent default\n  - Configurar DM scope padrão\n  - Ver todas as settings disponíveis\n---\n\n# Settings Manager\n\nConfigurações globais do sistema Ravi.\n\n## Comandos\n\n### Listar todas\n```bash\nravi settings list\n```\n\n### Ver valor\n```bash\nravi settings get <key>\n```\n\n### Definir valor\n```bash\nravi settings set <key> <value>\n```\n\n### Remover\n```bash\nravi settings delete <key>\n```\n\n## Settings Disponíveis\n\n| Key | Descrição | Valores |\n|-----|-----------|---------|\n| `defaultAgent` | Agent padrão quando nenhuma rota casa | ID do agent |\n| `defaultDmScope` | Escopo padrão de DMs | main, per-peer, per-channel-peer, per-account-channel-peer |\n| `defaultTimezone` | Fuso horário padrão | America/Sao_Paulo, etc |\n\n## Exemplos\n\nDefinir agent default:\n```bash\nravi settings set defaultAgent main\n```\n\nConfigurar timezone:\n```bash\nravi settings set defaultTimezone America/Sao_Paulo\n```\n"
      },
      {
        "path": "skills/triggers/SKILL.md",
        "content": "---\nname: trigger-manager\ndescription: |\n  Gerencia triggers de eventos do sistema Ravi. Use quando o usuário quiser:\n  - Criar, listar, ver ou deletar triggers\n  - Configurar reações automáticas a eventos (CLI, SDK tools, mensagens)\n  - Ativar/desativar triggers existentes\n  - Testar triggers manualmente\n---\n\n# Trigger Manager\n\nVocê gerencia os triggers de eventos do Ravi. Triggers são reações automáticas que disparam quando eventos específicos acontecem no sistema.\n\n## Comandos Disponíveis\n\n### Listar triggers\n```bash\nravi triggers list\n```\n\n### Ver detalhes de um trigger\n```bash\nravi triggers show <id>\n```\n\n### Criar trigger\n```bash\nravi triggers add \"<nome>\" --topic \"<pattern>\" --message \"<prompt>\"\n```\n\nOpções:\n- `--agent <id>` - Agent que processa (default: agent padrão)\n- `--cooldown <duration>` - Intervalo mínimo entre disparos (ex: 5s, 1m, 30s)\n- `--session <main|isolated>` - Sessão (default: isolated)\n\n### Ativar/Desativar\n```bash\nravi triggers enable <id>\nravi triggers disable <id>\n```\n\n### Configurar propriedades\n```bash\nravi triggers set <id> <key> <value>\n```\nKeys: name, message, topic, agent, session, cooldown\n\n### Testar trigger\n```bash\nravi triggers test <id>\n```\n\n### Deletar\n```bash\nravi triggers rm <id>\n```\n\n## Tópicos Disponíveis\n\nPatterns usam wildcards (`*`):\n\n| Pattern | Descrição |\n|---------|-----------|\n| `ravi.*.cli.{group}.{command}` | Execuções de CLI tools (ex: `ravi.*.cli.contacts.add`) |\n| `ravi.*.tool` | Execuções de SDK tools (Bash, Read, etc) |\n| `ravi.*.response` | Respostas de agents |\n| `whatsapp.*.inbound` | Mensagens WhatsApp recebidas |\n| `matrix.*.inbound` | Mensagens Matrix recebidas |\n\n**Nota:** Triggers em `.prompt`, `.response` e `.claude` são ignorados para evitar loops.\n\n## Exemplos\n\nCriar trigger para notificar quando lead é qualificado:\n```bash\nravi triggers add \"Lead Qualificado\" --topic \"ravi.*.cli.outbound.qualify\" --message \"Analise a qualificação e notifique o grupo\"\n```\n\nCriar trigger para monitorar erros:\n```bash\nravi triggers add \"Agent Error\" --topic \"ravi.*.tool\" --message \"Analise o erro e sugira correção\" --cooldown 1m\n```\n"
      },
      {
        "path": "skills/contacts/SKILL.md",
        "content": "---\nname: contacts-manager\ndescription: |\n  Gerencia contatos do sistema Ravi. Use quando o usuário quiser:\n  - Listar, adicionar, aprovar ou bloquear contatos\n  - Ver contatos pendentes de aprovação\n  - Configurar agent ou modo de resposta por contato\n  - Adicionar/remover tags ou buscar por tags\n  - Ver detalhes de um contato específico\n---\n\n# Contacts Manager\n\nVocê gerencia os contatos do Ravi. Contatos controlam quem pode interagir com o sistema e como são roteados.\n\n## Status de Contatos\n\n| Status | Descrição |\n|--------|-----------|\n| `allowed` | Pode interagir normalmente |\n| `pending` | Aguardando aprovação |\n| `blocked` | Bloqueado, mensagens ignoradas |\n| `discovered` | Descoberto mas não aprovado |\n\n## Comandos Disponíveis\n\n### Listar contatos\n```bash\nravi contacts list\n```\n\n### Ver pendentes\n```bash\nravi contacts pending\n```\n\n### Adicionar contato\n```bash\nravi contacts add <phone> [nome]\n```\n\n### Aprovar pendente\n```bash\nravi contacts approve <phone> [agent] [mode]\n```\n- `agent` - Agent ID para rotear (opcional)\n- `mode` - `auto` (responde sempre) ou `mention` (só quando mencionado)\n\n### Bloquear/Permitir\n```bash\nravi contacts block <phone>\nravi contacts allow <phone>\n```\n\n### Remover\n```bash\nravi contacts remove <phone>\n```\n\n### Ver detalhes\n```bash\nravi contacts check <phone>\n```\n\n### Configurar propriedades\n```bash\nravi contacts set <phone> <key> <value>\n```\n\nKeys disponíveis:\n- `agent` - Agent ID para rotear\n- `mode` - `auto` ou `mention`\n- `email` - Email do contato\n- `name` - Nome do contato\n- `tags` - Array JSON: `'[\"lead\",\"vip\"]'`\n- `notes` - Objeto JSON: `'{\"empresa\":\"Acme\"}'`\n- `opt-out` - `true` ou `false`\n\n## Tags\n\n### Adicionar tag\n```bash\nravi contacts tag <phone> <tag>\n```\n\n### Remover tag\n```bash\nravi contacts untag <phone> <tag>\n```\n\n### Buscar por tag\n```bash\nravi contacts find <tag> --tag\n```\n\n### Buscar por texto\n```bash\nravi contacts find <query>\n```\n\n## Exemplos\n\nAprovar contato e rotear para agent específico:\n```bash\nravi contacts approve 5511999999999 vendas auto\n```\n\nAdicionar tags a um contato:\n```bash\nravi contacts tag 5511999999999 lead\nravi contacts tag 5511999999999 interessado\n```\n\nConfigurar notas com contexto:\n```bash\nravi contacts set 5511999999999 notes '{\"empresa\":\"TechCorp\",\"cargo\":\"CTO\"}'\n```\n"
      },
      {
        "path": "skills/cross/SKILL.md",
        "content": "---\nname: cross-manager\ndescription: |\n  Gerencia mensagens entre sessões do Ravi. Use quando o usuário quiser:\n  - Enviar mensagens de uma sessão para outra\n  - Fazer perguntas para outro agent\n  - Notificar usuário em outro canal\n  - Ver sessões ativas\n---\n\n# Cross Manager\n\nCross-session messaging permite que um agent envie mensagens para outra sessão do Ravi.\n\n## Conceitos\n\n- **Session Key**: Identificador único de uma conversa (ex: `agent:main:main`, `agent:main:whatsapp:5511999999999`)\n- **Routing**: Canal e destino de entrega (ex: `whatsapp:5511999999999`)\n- **Type**: Tipo de mensagem que define como será tratada\n\n## Tipos de Mensagem\n\n| Type | Descrição |\n|------|-----------|\n| `send` | Envia mensagem que dispara prompt (resposta) |\n| `contextualize` | Adiciona contexto para próxima mensagem |\n| `execute` | Pede execução de ação |\n| `ask` | Faz pergunta atribuída ao sender |\n| `answer` | Responde a uma pergunta anterior |\n\n## Comandos\n\n### Enviar mensagem\n```bash\nravi cross send <target> <type> \"<message>\"\n```\n\nCom routing explícito:\n```bash\nravi cross send <target> <type> \"<message>\" --channel whatsapp --to 5511999999999\n```\n\nCom atribuição (pra ask/answer):\n```bash\nravi cross send <target> ask \"<pergunta>\" \"Nome do Sender\"\n```\n\n### Listar sessões\n```bash\nravi cross list\n```\n\n## Exemplos\n\nNotificar usuário no WhatsApp:\n```bash\nravi cross send \"agent:main:whatsapp:lid:12345\" send \"Tarefa concluída!\"\n```\n\nFazer pergunta para outro agent:\n```bash\nravi cross send \"agent:sde:main\" ask \"Como implementar X?\" \"Usuário\"\n```\n\nAdicionar contexto antes de mandar mensagem:\n```bash\nravi cross send \"agent:main:main\" contextualize \"Projeto: MoltTalent, Stack: React+Node\"\n```\n\nVer todas as sessões ativas:\n```bash\nravi cross list\n```\n\n## Session Keys\n\nFormato: `agent:<agentId>:<scope>[:<details>]`\n\nExemplos:\n- `agent:main:main` - Sessão principal do agent main\n- `agent:main:whatsapp:5511999999999` - DM do WhatsApp\n- `agent:main:whatsapp:group:123456@g.us` - Grupo do WhatsApp\n- `agent:main:matrix:!room:server` - Sala do Matrix\n\n## Routing\n\nA resposta vai pro canal correto baseado em:\n1. Parâmetros `--channel` e `--to` (se fornecidos)\n2. Último canal/destino da sessão\n3. Derivado da session key\n\nSe não houver routing, a resposta não é entregue em nenhum canal (fica só no contexto).\n"
      },
      {
        "path": "skills/agents/SKILL.md",
        "content": "---\nname: agents-manager\ndescription: |\n  Gerencia agents do sistema Ravi. Use quando o usuário quiser:\n  - Criar, configurar ou deletar agents\n  - Gerenciar permissões de tools (whitelist/bypass)\n  - Configurar permissões de Bash (allowlist/denylist)\n  - Ver ou resetar sessões de agents\n  - Configurar debounce de mensagens\n  - Entender como rotear mensagens pra um agent\n---\n\n# Agents Manager\n\nAgents são instâncias do Claude com configurações específicas (diretório, tools, permissões). Cada agent tem seu workspace, sessões independentes e pode atender canais/contatos diferentes.\n\n**Importante:** Criar ou modificar agents **não requer restart** do daemon. Tudo atualiza em tempo real.\n\n## Fluxo Completo: Criar um Agent e Colocar pra Funcionar\n\n### 1. Criar o agent\n\n```bash\nravi agents create <id> <cwd>\n```\n\nO `cwd` é o diretório onde fica o `CLAUDE.md` do agent (suas instruções). Crie o diretório e o `CLAUDE.md` antes.\n\n### 2. Rotear mensagens pro agent\n\nExistem duas formas de rotear:\n\n**Por rota (padrão de grupo/contato):**\n```bash\nravi routes add <pattern> <agent>\n```\n\nPatterns suportados:\n- `group:120363425628305127` — grupo específico\n- `lid:178035101794451` — contato específico (por lid)\n- `5511*` — todos com DDD 11\n- `*` — catch-all\n\n**Por contato (assignment direto):**\n```bash\nravi contacts approve <phone> <agent>\n# ou\nravi contacts set <phone> agent <agent>\n```\n\n### 3. Testar\n\nMande uma mensagem no canal/grupo configurado. O agent responde automaticamente.\n\n### Como novos contatos/grupos aparecem?\n\nQuando alguém novo manda mensagem (ou o bot é adicionado a um grupo novo), o contato aparece como **pending**:\n\n```bash\nravi contacts pending     # Ver contatos pendentes\n```\n\nPra aprovar e rotear:\n```bash\nravi contacts approve <phone> <agent>   # Aprova e associa ao agent\nravi contacts approve <phone>           # Aprova sem associar (usa rota ou default)\nravi contacts block <phone>             # Bloqueia\n```\n\n### Prioridade de roteamento\n\nQuando uma mensagem chega, o sistema resolve o agent nesta ordem:\n\n1. **Contato tem agent?** → usa o agent do contato\n2. **Tem rota que casa?** → usa o agent da rota (prioridade maior primeiro)\n3. **Account ID casa com agent?** → usa (Matrix multi-account)\n4. **Nenhum match** → usa o agent default (geralmente `main`)\n\n## Comandos Disponíveis\n\n### Listar agents\n```bash\nravi agents list\n```\n\n### Ver detalhes\n```bash\nravi agents show <id>\n```\n\n### Criar agent\n```bash\nravi agents create <id> <cwd>\n```\n\n### Deletar agent\n```bash\nravi agents delete <id>\n```\n\n### Configurar propriedades\n```bash\nravi agents set <id> <key> <value>\n```\n\nKeys:\n- `name` — Nome do agent\n- `cwd` — Diretório de trabalho\n- `model` — Modelo (claude-opus-4-6, claude-sonnet-4-5-20250929, etc)\n- `dmScope` — Escopo de sessão DM:\n  - `main` — Todas as DMs numa sessão só\n  - `per-peer` — Uma sessão por contato (default)\n  - `per-channel-peer` — Por canal + contato\n  - `per-account-channel-peer` — Isolamento total\n- `systemPromptAppend` — Texto adicional no system prompt\n- `matrixAccount` — Conta Matrix associada\n\n## Gerenciamento de Tools (CLI)\n\nControla quais comandos `ravi` o agent pode executar via Bash. Quando configurado, o agent só pode rodar os subcomandos permitidos.\n\n### Ver tools\n```bash\nravi agents tools <id>\n```\n\n### Permitir tool\n```bash\nravi agents tools <id> allow <tool>\n# Ex: ravi agents tools marina allow cross_send\n# Ex: ravi agents tools marina allow contacts_list\n```\n\n### Bloquear tool\n```bash\nravi agents tools <id> deny <tool>\n```\n\n### Inicializar whitelist\n```bash\nravi agents tools <id> init       # SDK tools apenas\nravi agents tools <id> init all   # SDK + CLI tools\nravi agents tools <id> init cli   # Apenas CLI tools\n```\n\n### Modo bypass (todas permitidas)\n```bash\nravi agents tools <id> clear\n```\n\n### Nomes dos tools\n\nOs nomes seguem o padrão `grupo_comando`. Pra ver todos disponíveis:\n```bash\nravi tools list\n```\n\nExemplos: `cross_send`, `media_send`, `contacts_list`, `contacts_approve`, `agents_list`, `daemon_restart`, `outbound_send`, etc.\n\n## Permissões de Bash\n\nControla quais executáveis o agent pode rodar no terminal (git, node, etc). Separado do controle de tools CLI.\n\n### Ver configuração\n```bash\nravi agents bash <id>\n```\n\n### Definir modo\n```bash\nravi agents bash <id> mode <bypass|allowlist|denylist>\n```\n\n- `bypass` — tudo permitido\n- `allowlist` — só os listados\n- `denylist` — tudo exceto os listados\n\n### Gerenciar listas\n```bash\nravi agents bash <id> allow <cli>     # Adicionar à allowlist\nravi agents bash <id> deny <cli>      # Adicionar à denylist\nravi agents bash <id> remove <cli>    # Remover das listas\n```\n\n### Inicializar com defaults\n```bash\nravi agents bash <id> init         # Denylist com CLIs perigosos (rm, sudo, curl, etc)\nravi agents bash <id> init strict  # Allowlist com CLIs seguros (git, node, etc)\n```\n\n### Resetar para bypass\n```bash\nravi agents bash <id> clear\n```\n\n## Debounce de Mensagens\n\nAgrupa mensagens rápidas antes de processar:\n\n```bash\nravi agents debounce <id> <ms>   # Definir (ex: 2000 = 2s)\nravi agents debounce <id> 0      # Desabilitar\nravi agents debounce <id>        # Ver atual\n```\n\n## Sessões\n\n### Ver sessões\n```bash\nravi agents session <id>\n```\n\n### Resetar sessão\n```bash\nravi agents reset <id>              # Sessão principal\nravi agents reset <id> <sessionKey> # Sessão específica\nravi agents reset <id> all          # Todas as sessões\n```\n\n## Interação\n\n### Enviar prompt\n```bash\nravi agents run <id> \"prompt\"\n```\n\n### Chat interativo\n```bash\nravi agents chat <id>\n```\n\n## Exemplos Práticos\n\n### Criar agent pra atendimento\n\n```bash\n# 1. Criar diretório e CLAUDE.md\nmkdir -p ~/ravi/atendimento\n# (crie o CLAUDE.md com as instruções do agent)\n\n# 2. Criar agent\nravi agents create atendimento ~/ravi/atendimento\n\n# 3. Rotear grupo pro agent\nravi routes add group:120363425628305127 atendimento\n\n# 4. Configurar permissões (opcional)\nravi agents bash atendimento init          # Denylist básica\nravi agents tools atendimento init         # Whitelist de SDK tools\nravi agents tools atendimento allow cross_send    # Liberar envio cross\nravi agents tools atendimento allow contacts_list # Liberar listagem\n```\n\n### Aprovar contato e associar a agent\n\n```bash\n# Ver pendentes\nravi contacts pending\n\n# Aprovar e associar\nravi contacts approve 5511999999999 atendimento\n\n# Ou aprovar com modo \"mention\" (só responde quando mencionado)\nravi contacts approve 5511999999999 atendimento mention\n```\n\n### Configurar rota com prioridade\n\n```bash\n# Rota específica (prioridade alta)\nravi routes add group:123456789 vendas\nravi routes set group:123456789 priority 10\n\n# Rota catch-all (prioridade baixa)\nravi routes add \"*\" main\n```\n"
      },
      {
        "path": "skills/heartbeat/SKILL.md",
        "content": "---\nname: heartbeat-manager\ndescription: |\n  Gerencia heartbeat dos agents. Use quando o usuário quiser:\n  - Configurar check-ins periódicos para agents\n  - Ativar/desativar heartbeat\n  - Definir intervalo e horários ativos\n  - Disparar heartbeat manualmente\n---\n\n# Heartbeat Manager\n\nHeartbeat são check-ins periódicos que um agent faz. O agent lê o arquivo HEARTBEAT.md do seu workspace e executa as instruções.\n\n## Como Funciona\n\n1. Agent tem heartbeat habilitado com intervalo (ex: 30min)\n2. A cada intervalo, o daemon envia prompt pro agent\n3. Agent lê HEARTBEAT.md e executa (ex: verificar pendências, enviar resumo)\n\n## Comandos\n\n### Ver status de todos\n```bash\nravi heartbeat status\n```\n\n### Ver config de um agent\n```bash\nravi heartbeat show <agent>\n```\n\n### Habilitar heartbeat\n```bash\nravi heartbeat enable <agent>\nravi heartbeat enable <agent> 30m    # Com intervalo\n```\n\n### Desabilitar heartbeat\n```bash\nravi heartbeat disable <agent>\n```\n\n### Configurar propriedades\n```bash\nravi heartbeat set <agent> interval 1h          # Intervalo\nravi heartbeat set <agent> model haiku          # Modelo (economia)\nravi heartbeat set <agent> active-hours 09:00-22:00  # Horário ativo\nravi heartbeat set <agent> active-hours always  # Sempre ativo\n```\n\n### Disparar manualmente\n```bash\nravi heartbeat trigger <agent>\n```\n\n## Arquivo HEARTBEAT.md\n\nCada agent precisa ter um `HEARTBEAT.md` no seu workspace com instruções do que fazer no check-in.\n\nExemplo:\n```markdown\n# Heartbeat - Check-in Periódico\n\n## O Que Verificar\n- Tarefas pendentes\n- Erros recentes nos logs\n- Mensagens não respondidas\n\n## Quando Notificar\n- Se algo importante ficou pendente\n- Se um processo crashou\n- Se há muito tempo sem interação\n\n## Como Notificar\nUse cross_send para enviar mensagem:\nravi cross send target=\"agent:main:main\" type=\"notify\" message=\"...\"\n```\n\n## Exemplos\n\nConfigurar heartbeat básico:\n```bash\nravi heartbeat enable main 30m\n```\n\nHeartbeat só em horário comercial:\n```bash\nravi heartbeat enable main 1h\nravi heartbeat set main active-hours 09:00-18:00\n```\n\nUsar modelo mais barato:\n```bash\nravi heartbeat set main model haiku\n```\n\nTestar configuração:\n```bash\nravi heartbeat trigger main\nravi daemon logs -f\n```\n"
      },
      {
        "path": "skills/daemon/SKILL.md",
        "content": "---\nname: daemon-manager\ndescription: |\n  Controla o daemon do Ravi. Use quando o usuário quiser:\n  - Ver status do daemon\n  - Reiniciar o daemon\n  - Ver logs\n  - Instalar/desinstalar serviço do sistema\n---\n\n# Daemon Manager\n\nO daemon é o processo principal que roda o bot e os gateways.\n\n## Comandos\n\n### Status\n```bash\nravi daemon status\n```\n\n### Iniciar\n```bash\nravi daemon start\n```\n\n### Parar\n```bash\nravi daemon stop\n```\n\n### Reiniciar\n```bash\nravi daemon restart\nravi daemon restart --message \"Motivo do restart\"\n```\n\n### Logs\n```bash\nravi daemon logs              # Últimas linhas\nravi daemon logs --tail 50    # Últimas 50 linhas\nravi daemon logs --follow     # Acompanhar em tempo real\nravi daemon logs --clear      # Limpar logs\nravi daemon logs --path       # Mostrar caminho do arquivo\n```\n\n### Modo Dev\n```bash\nravi daemon dev   # Rebuild automático ao editar código\n```\n\n### Serviço do Sistema\n\nInstalar como serviço (inicia no boot):\n```bash\nravi daemon install\n```\n\nDesinstalar:\n```bash\nravi daemon uninstall\n```\n\n## Arquivos\n\n- **Logs**: `~/.ravi/logs/daemon.log`\n- **PID**: gerenciado pelo launchd/systemd\n- **Env**: `~/.ravi/.env`\n\n## Editar variáveis de ambiente\n```bash\nravi daemon env\n```\n"
      },
      {
        "path": "skills/skills/SKILL.md",
        "content": "---\nname: skill-creator\ndescription: |\n  Guia para criar skills no Claude Code. Use quando o usuário quiser:\n  - Criar uma nova skill\n  - Entender como skills funcionam\n  - Configurar frontmatter de skills\n  - Adicionar skills a plugins\n---\n\n# Skill Creator - Guia Completo\n\nSkills estendem as capacidades do Claude. São arquivos markdown com instruções que Claude segue quando a skill é invocada.\n\n## Estrutura de uma Skill\n\n```\nskills/\n└── minha-skill/\n    └── SKILL.md          # Arquivo principal (obrigatório)\n    ├── template.md       # Template opcional\n    ├── examples/         # Exemplos opcionais\n    └── scripts/          # Scripts auxiliares\n```\n\n## Formato do SKILL.md\n\n```yaml\n---\nname: nome-da-skill\ndescription: |\n  Descrição detalhada. Claude usa isso para decidir\n  quando carregar a skill automaticamente.\n---\n\n# Título da Skill\n\nInstruções que Claude segue quando a skill é ativada.\n```\n\n## Frontmatter - Todas as Opções\n\n| Campo | Obrigatório | Descrição |\n|-------|-------------|-----------|\n| `name` | Não | Nome da skill. Se omitido, usa o nome da pasta |\n| `description` | Recomendado | Quando usar. Claude usa pra decidir auto-invocação |\n| `argument-hint` | Não | Hint no autocomplete: `[issue-number]` |\n| `disable-model-invocation` | Não | `true` = só user pode invocar (default: false) |\n| `user-invocable` | Não | `false` = esconde do menu / (default: true) |\n| `allowed-tools` | Não | Tools permitidas: `Read, Grep, Glob` |\n| `model` | Não | Modelo específico para a skill |\n| `context` | Não | `fork` = roda em subagent isolado |\n| `agent` | Não | Tipo de subagent quando `context: fork` |\n| `hooks` | Não | Hooks específicos da skill |\n\n## Tipos de Skills\n\n### 1. Skill de Referência (conhecimento)\nClaude aplica ao trabalho atual. Roda inline.\n\n```yaml\n---\nname: api-conventions\ndescription: Padrões de API do projeto\n---\n\nAo criar endpoints:\n- Use nomes RESTful\n- Retorne erros consistentes\n- Valide requests\n```\n\n### 2. Skill de Tarefa (ação)\nInstruções passo-a-passo. Geralmente user-invoked.\n\n```yaml\n---\nname: deploy\ndescription: Deploy para produção\ncontext: fork\ndisable-model-invocation: true\n---\n\nDeploy da aplicação:\n1. Rodar testes\n2. Build\n3. Push para produção\n```\n\n## Controle de Invocação\n\n| Configuração | User pode | Claude pode | Uso |\n|--------------|-----------|-------------|-----|\n| (default) | Sim | Sim | Skills gerais |\n| `disable-model-invocation: true` | Sim | Não | Ações com side-effects |\n| `user-invocable: false` | Não | Sim | Conhecimento de background |\n\n## Variáveis de Substituição\n\n| Variável | Descrição |\n|----------|-----------|\n| `$ARGUMENTS` | Todos os argumentos passados |\n| `$ARGUMENTS[N]` ou `$N` | Argumento específico (0-indexed) |\n| `${CLAUDE_SESSION_ID}` | ID da sessão atual |\n| `` !`command` `` | Executa comando e insere output |\n\n## Exemplo: Skill com Argumentos\n\n```yaml\n---\nname: fix-issue\ndescription: Corrige uma issue do GitHub\ndisable-model-invocation: true\n---\n\nCorrigir issue #$ARGUMENTS:\n\n1. Ler descrição da issue\n2. Implementar correção\n3. Escrever testes\n4. Criar commit\n```\n\nUso: `/fix-issue 123`\n\n## Exemplo: Skill com Contexto Dinâmico\n\n```yaml\n---\nname: pr-summary\ndescription: Resume um PR\ncontext: fork\nagent: Explore\nallowed-tools: Bash(gh *)\n---\n\n## Contexto do PR\n- Diff: !`gh pr diff`\n- Comentários: !`gh pr view --comments`\n\n## Tarefa\nResuma este PR...\n```\n\n## Onde Colocar Skills\n\n| Local | Caminho | Alcance |\n|-------|---------|---------|\n| Pessoal | `~/.claude/skills/` | Todos os projetos |\n| Projeto | `.claude/skills/` | Este projeto |\n| Plugin | `plugin/skills/` | Onde plugin está ativo |\n\n## Criando uma Skill - Passo a Passo\n\n1. **Criar diretório:**\n```bash\nmkdir -p ~/.claude/skills/minha-skill\n```\n\n2. **Criar SKILL.md:**\n```bash\ncat > ~/.claude/skills/minha-skill/SKILL.md << 'EOF'\n---\nname: minha-skill\ndescription: Descrição clara do que faz e quando usar\n---\n\nInstruções aqui...\nEOF\n```\n\n3. **Testar:**\n```\n/minha-skill\n```\n\n## Dicas\n\n- Mantenha SKILL.md < 500 linhas\n- Use arquivos separados para referências longas\n- Descrição clara = melhor auto-invocação\n- `allowed-tools` restringe para segurança\n- `context: fork` isola side-effects\n\n## Skills em Plugins\n\nPara distribuir skills:\n\n```\nmeu-plugin/\n├── .claude-plugin/\n│   └── plugin.json\n└── skills/\n    └── minha-skill/\n        └── SKILL.md\n```\n\nSkills de plugins usam namespace: `/meu-plugin:minha-skill`\n"
      },
      {
        "path": "skills/outbound/SKILL.md",
        "content": "---\nname: outbound-manager\ndescription: |\n  Gerencia filas de outbound do sistema Ravi. Use quando o usuário quiser:\n  - Criar, configurar ou gerenciar filas de mensagens automatizadas\n  - Adicionar contatos/leads a uma fila\n  - Ver status, relatórios ou histórico de conversas\n  - Qualificar leads ou atualizar contexto\n  - Pausar/iniciar filas ou resetar entries\n---\n\n# Outbound Manager\n\nVocê gerencia as filas de outbound do Ravi. Outbound são campanhas de mensagens automatizadas para prospecção, follow-up, ou comunicação em massa.\n\n## Comandos de Fila\n\n### Listar filas\n```bash\nravi outbound list\n```\n\n### Ver detalhes da fila\n```bash\nravi outbound show <id>\n```\n\n### Criar fila\n```bash\nravi outbound create \"<nome>\" --instructions \"<prompt>\" --every <interval>\n```\n\nOpções:\n- `--agent <id>` - Agent que processa\n- `--description <text>` - Descrição da fila\n- `--active-start <HH:MM>` - Horário início (ex: 09:00)\n- `--active-end <HH:MM>` - Horário fim (ex: 22:00)\n- `--tz <timezone>` - Fuso horário\n- `--follow-up <json>` - Delays por qualificação: `'{\"cold\":120,\"warm\":30}'`\n- `--max-rounds <n>` - Máximo de rounds por entry\n\n### Iniciar/Pausar fila\n```bash\nravi outbound start <id>\nravi outbound pause <id>\n```\n\n### Configurar propriedades\n```bash\nravi outbound set <id> <key> <value>\n```\nKeys: name, instructions, every, agent, description, active-start, active-end, tz, follow-up, max-rounds\n\n### Deletar fila\n```bash\nravi outbound rm <id>\n```\n\n### Executar manualmente\n```bash\nravi outbound run <id>\n```\n\n## Comandos de Entries\n\n### Adicionar entry\n```bash\nravi outbound add <queueId> <phone> --name \"Nome\" --context '{\"empresa\":\"Acme\"}'\n```\n\nOu adicionar por tag:\n```bash\nravi outbound add <queueId> - --tag \"leads\"\n```\n\n### Listar entries\n```bash\nravi outbound entries <queueId>\n```\n\n### Ver status de entry\n```bash\nravi outbound status <entryId>\n```\n\n### Ver histórico de chat\n```bash\nravi outbound chat <entryId>\n```\n\n### Atualizar contexto\n```bash\nravi outbound context <entryId> '{\"empresa\":\"Nova Info\"}'\n```\n\n### Qualificar lead\n```bash\nravi outbound qualify <entryId> <status>\n```\nStatus: cold, warm, interested, qualified, rejected\n\n### Marcar como concluído\n```bash\nravi outbound done <entryId>\nravi outbound complete <entryId>\nravi outbound skip <entryId>\n```\n\n### Resetar entry\n```bash\nravi outbound reset <entryId>\nravi outbound reset <entryId> --full  # Limpa contexto também\n```\n\n## Relatório Completo\n\n```bash\nravi outbound report              # Todas as filas\nravi outbound report <queueId>    # Fila específica\n```\n\n## Enviar Mensagem Manual\n\n```bash\nravi outbound send <entryId> \"Mensagem\"\n```\n\nOpções:\n- `--account <id>` - Conta WhatsApp\n- `--typing-delay <ms>` - Delay de digitação\n- `--pause <ms>` - Pausa antes de digitar\n"
      },
      {
        "path": "skills/matrix/SKILL.md",
        "content": "---\nname: matrix-manager\ndescription: |\n  Gerencia contas e comunicação Matrix. Use quando o usuário quiser:\n  - Adicionar, listar ou remover contas Matrix\n  - Enviar mensagens via Matrix\n  - Ver ou criar salas/rooms\n  - Convidar usuários para salas\n  - Verificar status de conexão\n---\n\n# Matrix Manager\n\nMatrix é um protocolo de mensagens federado. Ravi usa Matrix para comunicação entre agents e usuários.\n\n## Gerenciamento de Contas\n\n### Listar contas\n```bash\nravi matrix users-list\n```\n\n### Adicionar conta (login ou registro)\n```bash\nravi matrix users-add <username> -p <password>\nravi matrix users-add <username> -p <password> -h https://matrix.org\n```\n\n### Remover conta\n```bash\nravi matrix users-remove <username>\n```\n\n### Verificar identidade\n```bash\nravi matrix whoami <account>\n```\n\n### Status de conexão\n```bash\nravi matrix status\nravi matrix status <agent>\n```\n\n## Contas de Agents\n\nAgents podem ter contas Matrix associadas:\n\n### Registrar conta pra agent\n```bash\nravi matrix register <agent>\nravi matrix register <agent> -h http://localhost:8008 -u username -p password\n```\n\n### Login de agent\n```bash\nravi matrix login <agent>\n```\n\n### Logout de agent\n```bash\nravi matrix logout <agent>\n```\n\n### Listar contas de agents\n```bash\nravi matrix accounts\n```\n\n## Salas (Rooms)\n\n### Listar salas\n```bash\nravi matrix rooms <account>\n```\n\n### Criar sala\n```bash\nravi matrix create-room <account> \"Nome da Sala\"\nravi matrix create-room <account> \"Sala Pública\" --public\nravi matrix create-room <account> \"Com Alias\" --alias minha-sala\nravi matrix create-room <account> \"Com Convite\" --invite @user:server\n```\n\n### Entrar em sala\n```bash\nravi matrix join <account> <room_id>\nravi matrix join <account> \"#alias:server\"\n```\n\n### Convidar pra sala\n```bash\nravi matrix invite <target_user> <room_id> --from <account>\n```\n\n### Criar DM\n```bash\nravi matrix dm <from_account> <to_account_or_user>\n```\n\n## Mensagens\n\n### Ver mensagens\n```bash\nravi matrix messages <account> <room_id>\nravi matrix messages <account> <room_id> --limit 50\n```\n\n### Enviar mensagem\n```bash\nravi matrix send <account> <room_id> \"Mensagem\"\nravi matrix send <account> @user:server \"DM direto\"\n```\n\n## Exemplos\n\nCriar conta e enviar mensagem:\n```bash\nravi matrix users-add bot -p senha123\nravi matrix send bot \"#geral:localhost\" \"Olá!\"\n```\n\nConfigurar agent com Matrix:\n```bash\nravi matrix register meu-agent -h http://localhost:8008\nravi agents set meu-agent matrixAccount meu-agent\nravi daemon restart\n```\n\nCriar sala privada entre agents:\n```bash\nravi matrix create-room agent1 \"Discussão\" --invite @agent2:localhost\nravi matrix join agent2 \"!roomid:localhost\"\n```\n"
      },
      {
        "path": "skills/routes/SKILL.md",
        "content": "---\nname: routes-manager\ndescription: |\n  Gerencia rotas de mensagens do Ravi. Use quando o usuário quiser:\n  - Criar, listar ou remover rotas\n  - Direcionar contatos/grupos para agents específicos\n  - Configurar prioridade de rotas\n  - Ver qual agent atende qual padrão\n---\n\n# Routes Manager\n\nRotas direcionam mensagens para agents baseado em padrões. Um contato ou grupo pode ser roteado para um agent específico.\n\n## Comandos\n\n### Listar rotas\n```bash\nravi routes list\n```\n\n### Ver detalhes\n```bash\nravi routes show <pattern>\n```\n\n### Adicionar rota\n```bash\nravi routes add <pattern> <agent>\n```\n\nExemplos de padrões:\n- `5511*` - Todos com DDD 11\n- `*999*` - Números contendo 999\n- `group:123456` - Grupo específico do WhatsApp\n- `*` - Catch-all (fallback)\n\n### Remover rota\n```bash\nravi routes remove <pattern>\n```\n\n### Configurar propriedades\n```bash\nravi routes set <pattern> <key> <value>\n```\n\nKeys:\n- `priority` - Prioridade (maior = mais prioritário)\n- `dmScope` - Escopo de DM (main, per-peer, etc)\n\n## Prioridade de Resolução\n\n1. Contato com agent atribuído diretamente\n2. Rota que casa com o padrão (por prioridade)\n3. AccountId = AgentId\n4. Agent default\n\n## Exemplos\n\nRotear grupo para agent especializado:\n```bash\nravi routes add \"group:120363123456789@g.us\" projeto-x\n```\n\nRotear todos de SP para agent:\n```bash\nravi routes add \"5511*\" vendas\n```\n\nDefinir fallback:\n```bash\nravi routes add \"*\" main\n```\n"
      },
      {
        "path": "skills/cron/SKILL.md",
        "content": "---\nname: cron-manager\ndescription: |\n  Gerencia jobs agendados do sistema Ravi. Use quando o usuário quiser:\n  - Criar, listar ou deletar tarefas agendadas\n  - Configurar cron expressions, intervalos ou horários específicos\n  - Ativar/desativar jobs existentes\n  - Executar jobs manualmente\n---\n\n# Cron Manager\n\nVocê gerencia os jobs agendados do Ravi. Jobs são tarefas que rodam automaticamente em horários ou intervalos específicos.\n\n## Tipos de Schedule\n\n| Tipo | Exemplo | Descrição |\n|------|---------|-----------|\n| `--cron` | `\"0 9 * * *\"` | Cron expression (todo dia 9h) |\n| `--every` | `30m`, `1h`, `2h30m` | Intervalo fixo |\n| `--at` | `2025-02-01T15:00` | Horário único (one-shot) |\n\n## Comandos Disponíveis\n\n### Listar jobs\n```bash\nravi cron list\n```\n\n### Ver detalhes\n```bash\nravi cron show <id>\n```\n\n### Criar job\n\nCom cron expression:\n```bash\nravi cron add \"Relatório Diário\" --cron \"0 9 * * *\" --message \"Gere o relatório diário\"\n```\n\nCom intervalo:\n```bash\nravi cron add \"Check Emails\" --every 30m --message \"Verifique novos emails\"\n```\n\nOne-shot (executa uma vez):\n```bash\nravi cron add \"Lembrete\" --at \"2025-02-01T15:00\" --message \"Lembrar de X\" --delete-after\n```\n\nOpções:\n- `--agent <id>` - Agent que executa\n- `--tz <timezone>` - Fuso horário (ex: America/Sao_Paulo)\n- `--isolated` - Roda em sessão isolada\n- `--delete-after` - Deleta após primeira execução\n- `--description <text>` - Descrição do job\n\n### Ativar/Desativar\n```bash\nravi cron enable <id>\nravi cron disable <id>\n```\n\n### Configurar propriedades\n```bash\nravi cron set <id> <key> <value>\n```\n\nKeys: name, message, cron, every, tz, agent, description, session, delete-after\n\n### Executar manualmente\n```bash\nravi cron run <id>\n```\n\n### Deletar\n```bash\nravi cron rm <id>\n```\n\n## Cron Expression Reference\n\n```\n┌───────────── minuto (0-59)\n│ ┌───────────── hora (0-23)\n│ │ ┌───────────── dia do mês (1-31)\n│ │ │ ┌───────────── mês (1-12)\n│ │ │ │ ┌───────────── dia da semana (0-6, 0=domingo)\n│ │ │ │ │\n* * * * *\n```\n\nExemplos:\n- `0 9 * * *` - Todo dia às 9h\n- `0 9 * * 1-5` - Dias úteis às 9h\n- `*/15 * * * *` - A cada 15 minutos\n- `0 0 1 * *` - Primeiro dia do mês à meia-noite\n- `0 18 * * 5` - Toda sexta às 18h\n\n## Exemplos\n\nRelatório semanal toda segunda:\n```bash\nravi cron add \"Weekly Report\" --cron \"0 9 * * 1\" --message \"Gere relatório semanal\" --tz \"America/Sao_Paulo\"\n```\n\nVerificação a cada 2 horas:\n```bash\nravi cron add \"Health Check\" --every 2h --message \"Verifique status dos sistemas\"\n```\n\nLembrete único:\n```bash\nravi cron add \"Reunião\" --at \"2025-01-30T14:00\" --message \"Lembrar: reunião em 15min\" --delete-after\n```\n"
      },
      {
        "path": "skills/channels/SKILL.md",
        "content": "---\nname: channels-manager\ndescription: |\n  Gerencia canais de comunicação do Ravi. Use quando o usuário quiser:\n  - Ver status dos canais (WhatsApp, Matrix)\n  - Iniciar, parar ou reiniciar canais\n  - Verificar conexão do WhatsApp\n  - Troubleshoot problemas de conexão\n---\n\n# Channels Manager\n\nCanais são as interfaces de comunicação (WhatsApp, Matrix, etc).\n\n## Comandos\n\n### Ver status\n```bash\nravi channels status\nravi channels status whatsapp\nravi channels status matrix\n```\n\n### Listar canais\n```bash\nravi channels list\n```\n\n### Iniciar canal\n```bash\nravi channels start <target>\n```\n\n### Parar canal\n```bash\nravi channels stop <target>\n```\n\n### Reiniciar canal\n```bash\nravi channels restart <target>\n```\n\n## Targets\n\n- `whatsapp` - Gateway WhatsApp\n- `matrix` - Gateway Matrix\n- `<accountId>` - Conta específica\n\n## Troubleshooting\n\n### WhatsApp desconectado\n```bash\nravi channels status whatsapp\nravi channels restart whatsapp\n```\n\n### Ver QR code novamente\n```bash\nravi service wa\n```\n\n### Matrix não conecta\n```bash\nravi channels status matrix\nravi matrix status\n```\n"
      }
    ]
  },
  {
    "name": "ravi-dev",
    "manifest": {
      "name": "ravi-dev",
      "version": "1.0.0",
      "description": "Ravi meta-development skills - architecture docs, prompt system, and internal patterns"
    },
    "files": [
      {
        "path": ".claude-plugin/plugin.json",
        "content": "{\n  \"name\": \"ravi-dev\",\n  \"version\": \"1.0.0\",\n  \"description\": \"Ravi meta-development skills - architecture docs, prompt system, and internal patterns\"\n}\n"
      },
      {
        "path": "skills/architecture/SKILL.md",
        "content": "---\nname: ravi-architecture\ndescription: |\n  Documentacao completa da arquitetura do Ravi. Use quando precisar:\n  - Entender como o sistema funciona end-to-end\n  - Modificar componentes existentes\n  - Adicionar novos subsistemas\n  - Debugar fluxos de mensagem\n  - Onboarding no codebase\n---\n\n# Ravi - Arquitetura do Sistema\n\nRavi e um sistema multi-agent construido sobre o Claude Agent SDK que orquestra conversas em multiplas plataformas (WhatsApp, Matrix, TUI).\n\n**Repositorio:** `/Users/luis/dev/filipelabs/ravi.bot`\n**Runtime:** Bun | **DB:** SQLite | **PubSub:** notif.sh | **AI:** Claude SDK\n\n## Fluxo Principal de Mensagens\n\n```\n[WhatsApp/Matrix/TUI]\n    -> Channel Plugin (normaliza mensagem)\n    -> Gateway (formata envelope, resolve rota)\n    -> notif.emit(\"ravi.{sessionKey}.prompt\")\n    -> RaviBot (Claude SDK query)\n    -> notif.emit(\"ravi.{sessionKey}.response\")\n    -> Gateway (roteia para canal)\n    -> [WhatsApp/Matrix/TUI]\n```\n\n## Componentes Core\n\n### daemon.ts - Ponto de Entrada\nOrquestra startup de todos os subsistemas:\n1. Carrega env de `~/.ravi/.env`\n2. Inicia RaviBot (Claude SDK)\n3. Cria Gateway com channel plugins\n4. Registra WhatsApp + Matrix\n5. Inicia HeartbeatRunner, CronRunner, OutboundRunner, TriggerRunner\n\n### gateway.ts - Orquestrador de Mensagens\n**Inbound:** Channel normaliza msg -> Gateway resolve rota -> emite prompt\n**Outbound:** Bot emite response -> Gateway extrai target -> envia pro canal\n\nSubscriptions importantes:\n- `{channelId}.*.inbound` - Msgs dos canais\n- `ravi.*.response` - Respostas do bot\n- `ravi.outbound.deliver` - Envio direto do outbound\n- `ravi.media.send` - Envio de midia\n\nFeatures:\n- Ghost detection via `_emitId` (previne duplicatas de restarts)\n- Typing indicator automatico\n- Outbound suppression (msgs de contatos outbound nao geram prompt)\n\n### bot.ts - Core do Bot\nProcessa prompts usando Claude Agent SDK.\n\n**Fluxo:**\n1. Subscribe em `ravi.*.prompt`\n2. Resolve agent config pela session key\n3. Debounce se configurado\n4. Cria/resume SDK session\n5. Streama resposta -> emite responses parciais\n6. Gerencia interrupts (msg nova durante processamento)\n\n**Interrupt handling:**\n- Tool rodando -> enfileira msg\n- Sem tool -> aborta query atual\n- Apos tool terminar -> checa fila -> interrupt\n- Msgs enfileiradas sao combinadas em 1 prompt\n\n**Abort control:**\n- Cada sessao tem AbortController\n- Novo prompt aborta subprocess anterior\n- Daemon stop aborta TODOS os controllers\n- Watchdog de 5min detecta sessoes travadas\n\n### router/ - Sistema de Roteamento\n\n**Resolucao de rota (prioridade):**\n1. Agent atribuido ao contato\n2. Rota com pattern match\n3. AccountId = AgentId (Matrix)\n4. Agent default\n\n**Session keys:**\n```\nagent:{agentId}:{scope}:{peerId}\nagent:main:main                          # Todas DMs (scope=main)\nagent:main:dm:5511999                    # Por contato\nagent:main:whatsapp:group:123456         # Grupo\nagent:main:outbound:queueId:phone        # Outbound\n```\n\n**DM Scopes:**\n- `main` - Todas DMs compartilham 1 sessao\n- `per-peer` - Isolado por contato (default)\n- `per-channel-peer` - Isolado por canal+contato\n- `per-account-channel-peer` - Isolamento total\n\n**Arquivos:**\n- `router/resolver.ts` - Resolve rota -> session key\n- `router/session-key.ts` - Constroi/parseia session keys\n- `router/sessions.ts` - CRUD de sessoes (SQLite)\n- `router/config.ts` - Carrega config de agents/routes\n- `router/router-db.ts` - Camada de banco\n\n### channels/ - Abstracao de Canais\n\nInterface unificada para plataformas de mensagem.\n\n**Adapters:**\n- ConfigAdapter - Configuracao de contas\n- SecurityAdapter - Controle de acesso\n- OutboundAdapter - Envio de msgs, typing, reactions\n- GatewayAdapter - Lifecycle de conexao\n- StatusAdapter - Health monitoring\n\n**WhatsApp (`channels/whatsapp/`):**\n- Baileys SDK, multi-account, QR pairing\n- Media download com limites de tamanho\n- Transcricao de audio (OpenAI Whisper)\n- JID/LID resolution\n- Sessao em `~/ravi/sessions/whatsapp/{accountId}/`\n\n**Matrix (`channels/matrix/`):**\n- matrix-bot-sdk, multi-account\n- E2E encryption, device verification\n- Credenciais em `~/ravi/sessions/matrix/accounts.json`\n- Cada agent pode ter matrixAccount diferente\n\n## Subsistemas de Automacao\n\n### Outbound (`outbound/`)\nCampanhas de mensagens proativas com processamento round-robin.\n\n**Fluxo:**\n1. Runner pega proxima queue do DB\n2. Arma timer para `nextRunAt`\n3. Processa entries por prioridade:\n   - Response entries (contato respondeu)\n   - Follow-up entries (sem resposta, precisa follow-up)\n   - Initial outreach (entries pendentes)\n4. Manda prompt para agent com contexto da campanha\n\n**Qualificacao:** cold -> warm -> interested -> qualified/rejected\n\n### Triggers (`triggers/`)\nAutomacao event-driven disparada por eventos do sistema.\n\n**Fluxo:**\n1. Runner subscribe em topics configurados\n2. Evento dispara -> busca triggers ativos com match\n3. Emite prompt para sessao target do trigger\n4. Respeita cooldown entre disparos\n\n### Cron (`cron/`)\nJobs agendados com suporte a multiplos formatos.\n\n**Schedules:** cron expression | interval (\"30m\") | daily (\"09:00\") | at (one-time)\n\n**Fluxo:** Timer -> job due -> emite prompt -> calcula proximo run\n\n### Heartbeat (`heartbeat/`)\nCheck-ins periodicos de agents dentro de horarios ativos.\n\n**Fluxo:**\n1. Checa agents com heartbeat enabled\n2. Para cada sessao, verifica se esta due\n3. Checa active hours (timezone-aware)\n4. Envia prompt de status check\n5. `HEARTBEAT_OK` = silencioso, qualquer outro texto = envia pro canal\n\n### Cross-Send (`cli/commands/cross.ts`)\nMensagens entre sessoes (inter-agent communication).\n\n**Tipos:** send | contextualize | execute | ask | answer\n\n**Ask/Answer flow:**\n1. Agent A: `cross_send target ask \"pergunta\" sender`\n2. Bot emite `[System] Ask:` para target\n3. Agent B responde, usa `cross_send origin answer \"resposta\"`\n4. Bot emite `[System] Answer:` para origin\n\n## Sistema de Plugins\n\n**Duas fontes:**\n1. **Internos** - Embutidos no build, extraidos para `~/.cache/ravi/plugins/`\n2. **Usuario** - Customizados em `~/ravi/plugins/`\n\n**Build time:** `gen-plugins.ts` escaneia `src/plugins/internal/` e gera `internal-registry.ts`\n**Runtime:** `discoverPlugins()` extrai internos + escaneia user dir -> passa para SDK\n\n## Sistema de Hooks\n\n### PreToolUse (bash/hook.ts)\nIntercepta chamadas Bash e valida contra BashConfig do agent.\nModos: bypass | allowlist | denylist\n\n### PreCompact (hooks/pre-compact.ts)\nExtrai memorias antes do SDK compactar contexto.\nLe `COMPACT_INSTRUCTIONS.md` do agent, roda modelo barato em background, atualiza `MEMORY.md`.\n\n## Infraestrutura CLI\n\n### Decorators\n```typescript\n@Group({ name: \"agents\" })\nclass AgentCommands {\n  @Command({ name: \"list\" })\n  list() { ... }\n\n  @Command({ name: \"create\" })\n  create(@Arg(\"id\") id: string) { ... }\n}\n```\n\n### Contexto (AsyncLocalStorage)\n```typescript\nrunWithContext({ sessionKey, agentId, source }, async () => {\n  // CLI tools acessam contexto sem parametros\n  const ctx = getContext();\n});\n```\n\n## Storage\n\n```\n~/ravi/ravi.db          - SQLite: agents, routes, sessions, contacts, settings\n~/.ravi/.env            - API keys e env vars\n~/.ravi/logs/           - Logs do daemon\n~/ravi/{agent-id}/      - Diretorios dos agents (CLAUDE.md, MEMORY.md)\n~/ravi/sessions/        - Sessoes dos canais (WhatsApp, Matrix)\n~/.cache/ravi/plugins/  - Plugins internos extraidos\n~/.claude/sessions/     - SDK session files (JSONL)\n```\n\n## Padroes Importantes\n\n1. **PubSub via notif** - Tudo comunica via topics\n2. **Ghost detection** - `_emitId` + `_instanceId` previne duplicatas\n3. **Abort control** - AbortController por sessao, cleanup no stop\n4. **Debouncing** - Agrupa msgs rapidas por window configuravel\n5. **Outbound suppression** - Msgs de contatos outbound nao geram prompt duplicado\n6. **Silent token** - `@@SILENT@@` suprime emissao pro canal\n7. **Session resumption** - SDK sessions persistem entre mensagens\n"
      },
      {
        "path": "skills/prompt-builder/SKILL.md",
        "content": "---\nname: prompt-builder\ndescription: |\n  Documenta o sistema de construcao de prompts do Ravi. Use quando precisar:\n  - Entender como system prompts sao montados\n  - Adicionar novas secoes ao prompt\n  - Modificar formatacao por canal\n  - Entender injecao de contexto (grupo, reactions, runtime)\n  - Criar novas regras de output por plataforma\n---\n\n# Prompt Builder - Sistema de Injecao de Contexto\n\nO prompt builder constroi o system prompt appendix que e injetado em cada chamada do Claude SDK.\nEle adapta o comportamento do agent baseado no canal, grupo, e contexto da mensagem.\n\n**Arquivo:** `src/prompt-builder.ts`\n\n## Como Funciona\n\n```typescript\n// bot.ts - na hora de processar prompt\nconst systemPromptAppend = buildSystemPrompt(agent.id, prompt.context);\n\nquery({\n  prompt: prompt.prompt,\n  options: {\n    systemPrompt: {\n      type: \"preset\",\n      preset: \"claude_code\",\n      append: systemPromptAppend,  // <-- injetado aqui\n    },\n  },\n});\n```\n\nO SDK usa o preset `claude_code` como base e appenda nossas secoes.\n\n## Estrutura do Builder\n\n```typescript\nclass PromptBuilder {\n  section(title: string, content: string): this;\n  build(): string;  // Retorna \"## Title\\n\\nContent\" para cada secao\n}\n```\n\n## Secoes Injetadas\n\nA funcao `buildSystemPrompt(agentId, ctx)` monta as secoes:\n\n### 1. Identidade (sempre)\n```\n## Identidade\nVoce e Ravi.\n```\n\n### 2. System Commands (sempre)\nProtocolo de comandos internos:\n- `[System] Send: <msg>` - Responda APENAS com a mensagem\n- `[System] Context: <info>` - Lembre desta info, responda com @@SILENT@@ ou ack curto\n- `[System] Execute: <task>` - Execute usando tools\n- `[System] Ask: [from: <session>] <question>` - Pergunta cross-session\n- `[System] Answer: [from: <session>] <response>` - Resposta cross-session\n\n### 3. Runtime (quando tem contexto de canal)\n```\nRuntime: agent=main | channel=WhatsApp | capabilities=polls,reactions\n```\n\n### 4. Output Formatting (quando tem contexto de canal)\nFormatacao adaptada por plataforma:\n\n**WhatsApp:**\n- Listas com emojis numerados (1, 2, 3)\n- Icones visuais para hierarquia\n- Status com check/x\n- Sem tabelas markdown\n- Conciso (telas mobile)\n\n**Matrix:**\n- Markdown rico (tabelas, negrito, codigo)\n\n**TUI:**\n- ASCII tables (| - +)\n\n### 5. Reactions (quando tem contexto de canal)\nInstrucoes de quando usar emoji reactions vs texto:\n- Prefira emoji sobre \"ok\", \"entendi\", \"beleza\"\n- Use `react_send` com o `[mid:ID]` da mensagem\n- Nao reaja E responda ao mesmo tempo\n\n### 6. Contexto de Grupo (quando isGroup=true)\n```\nVoce esta respondendo no grupo \"Familia\".\nMembros: Joao, Maria, Luis.\nSeja seletivo: responda so quando mencionado ou claramente util.\nSe nao precisa responder: @@SILENT@@\n```\n\n## Fluxo de Contexto\n\n```\nWhatsApp msg recebida\n    -> Channel normaliza -> InboundMessage\n    -> Gateway extrai MessageContext:\n       { channelId, channelName, senderId, isGroup, groupName, groupMembers, ... }\n    -> Emite para bot com context\n    -> bot.ts chama buildSystemPrompt(agentId, context)\n    -> Prompt appendix montado com secoes relevantes\n    -> Passado para Claude SDK\n```\n\n## MessageContext (origem)\n\n```typescript\ninterface MessageContext {\n  channelId: string;       // \"whatsapp\"\n  channelName: string;     // \"WhatsApp\"\n  accountId: string;       // \"default\"\n  chatId: string;          // \"5511999999999\"\n  messageId: string;       // ID da msg\n  senderId: string;        // Quem mandou\n  senderName?: string;     // Nome do remetente\n  senderPhone?: string;    // Telefone\n  isGroup: boolean;\n  groupName?: string;\n  groupId?: string;\n  groupMembers?: string[];\n  timestamp: number;\n}\n```\n\n## ChannelContext (persistido)\n\nMetadados estaveis que sao salvos na sessao para reuso:\n\n```typescript\ninterface ChannelContext {\n  channelId: string;\n  channelName: string;\n  isGroup: boolean;\n  groupName?: string;\n  groupId?: string;\n  groupMembers?: string[];\n}\n```\n\nSalvo em `sessions.last_context` como JSON. Usado pelo cross-send para reconstruir contexto.\n\n## Silent Token\n\n```typescript\nexport const SILENT_TOKEN = \"@@SILENT@@\";\n```\n\nQuando o agent responde com este token:\n- Gateway NAO envia para o canal\n- Bot emite evento `{ type: \"silent\" }` para parar typing\n- Usado em grupos quando nao precisa responder\n\n## Como Adicionar uma Nova Secao\n\n1. Crie a funcao no `prompt-builder.ts`:\n```typescript\nfunction minhaSecao(ctx: ChannelContext): string {\n  return `Instrucoes especificas aqui...`;\n}\n```\n\n2. Adicione ao builder em `buildSystemPrompt()`:\n```typescript\nbuilder.section(\"Minha Secao\", minhaSecao(ctx));\n```\n\n3. Rebuild e reinicie o daemon.\n\n## Como Adicionar Formatacao para Novo Canal\n\n1. Adicione um case em `outputFormattingText()`:\n```typescript\nif (channelName === \"MeuCanal\") {\n  return `Regras de formatacao para MeuCanal...`;\n}\n```\n\n2. O channelName vem do `ChannelPlugin.meta.name`.\n\n## Outbound System Context\n\nO sistema de outbound injeta contexto adicional via `prompt._outboundSystemContext`:\n```typescript\nif (prompt._outboundSystemContext) {\n  systemPromptAppend += \"\\n\\n\" + prompt._outboundSystemContext;\n}\n```\n\nIsso inclui:\n- Instrucoes da queue\n- Tools disponiveis (outbound_send, outbound_qualify, etc)\n- Workflow de qualificacao\n- Metadata da entry (ID, round, qualification)\n"
      }
    ]
  }
];

/** Get internal plugin by name */
export function getInternalPlugin(name: string): InternalPlugin | undefined {
  return INTERNAL_PLUGINS.find(p => p.name === name);
}

/** Get all internal plugin names */
export function getInternalPluginNames(): string[] {
  return INTERNAL_PLUGINS.map(p => p.name);
}
